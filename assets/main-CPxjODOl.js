const qt="modulepreload",zt=function(t){return"/"+t},ft={},mt=function(e,r,c){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),a=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));o=Promise.allSettled(r.map(i=>{if(i=zt(i),i in ft)return;ft[i]=!0;const d=i.endsWith(".css"),s=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${s}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":qt,d||(h.as="script"),h.crossOrigin="",h.href=i,a&&h.setAttribute("nonce",a),document.head.appendChild(h),d)return new Promise((m,f)=>{h.addEventListener("load",m),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})}))}function l(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return o.then(u=>{for(const a of u||[])a.status==="rejected"&&l(a.reason);return e().catch(l)})},g={};function Ht(){Object.assign(g,{layoutModeBtn:document.getElementById("layout-mode-btn"),stitchingModeBtn:document.getElementById("stitching-mode-btn"),layoutControls:document.getElementById("layout-controls"),layoutContainer:document.getElementById("layout-container"),stitchingControls:document.getElementById("stitching-controls"),stitchingDirectionBtns:document.getElementById("stitching-direction-btns"),stitchingUploadBtn:document.getElementById("stitching-upload-btn"),stitchingUploadInput:document.getElementById("stitching-upload-input"),layoutWrapper:document.getElementById("layout-wrapper"),layoutGrid:document.getElementById("layout-grid"),stitchingWrapper:document.getElementById("stitching-wrapper"),stitchingGrid:document.getElementById("stitching-grid"),canvasHint:document.getElementById("canvas-hint"),canvasSettings:document.getElementById("canvas-settings"),aspectRatioBtns:document.getElementById("aspect-ratio-btns"),spacingSlider:document.getElementById("spacing-slider"),spacingValue:document.getElementById("spacing-value"),radiusSlider:document.getElementById("radius-slider"),radiusValue:document.getElementById("radius-value"),colorPicker:document.getElementById("color-picker"),shuffleBtn:document.getElementById("shuffle-btn"),downloadBtn:document.getElementById("download-btn"),borderTopInput:document.getElementById("border-top-input"),borderRightInput:document.getElementById("border-right-input"),borderBottomInput:document.getElementById("border-bottom-input"),borderLeftInput:document.getElementById("border-left-input"),borderControls:document.getElementById("border-controls"),toast:document.getElementById("toast")})}function E(t,e){const r=document.createElement(t);return e&&(r.className=e),r}const q={upload:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',remove:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',replace:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>',zoomIn:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',zoomOut:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>',zoomReset:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="4"></circle></svg>',pan:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l0 20"/><path d="M2 12l20 0"/><path d="m5 15 3-3-3-3"/><path d="m19 9-3 3 3 3"/></svg>',reset:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14m-7-7h14" stroke="#000" stroke-width="2"/><path d="M18.5 9L12 15.5 5.5 9" stroke="#000" stroke-width="2"/></svg>'},F={"2-t1b1":{g:2,gr:[2,1],c:[{r:1,c:1},{r:1,c:1}]},"2-l1r1":{g:2,gr:[1,2],c:[{r:1,c:1},{r:1,c:1}]},"3-t1b2":{g:3,gr:[2,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"3-t2b1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"3-l1r2":{g:3,gr:[2,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"3-l2r1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"3-l1rr":{g:3,gr:[3,3],c:[{r:3,c:2},{r:1,c:1},{r:2,c:1}]},"3-t1bb":{g:3,gr:[3,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:2}]},"4-grid":{g:4,gr:[2,2]},"4-t1b3":{g:4,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-b1t3":{g:4,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"4-l1r3":{g:4,gr:[3,2],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-l-feat":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"4-r-feat":{g:4,gr:[2,3],c:[{r:1,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1,s:[2,1]}]},"4-121":{g:4,gr:[3,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"4-212":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"4-g3x2-alt":{g:4,gr:[3,2],c:[{r:2,c:1},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[1,2]},{r:2,c:1,s:[2,2]}]},"5-center":{g:5,gr:[3,3],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:2}]},"5-l3r2":{g:5,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"5-131":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1}]},"5-l2r3":{g:5,gr:[3,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t2b3":{g:5,gr:[2,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-center-h-bar":{g:5,gr:[3,2],c:[{r:1,c:1},{r:1,c:1,s:[1,2]},{r:1,c:2,s:[2,1]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-t2b3-split":{g:5,gr:[2,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"5-l1r4-col":{g:5,gr:[4,2],c:[{r:4,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t-feat-r":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t1b4-grid":{g:5,gr:[3,2],c:[{r:1,c:2},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-r1l4-col":{g:5,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:4,c:1,s:[1,2]}]},"5-cross-center":{g:5,gr:[3,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:3,s:[3,1]},{r:1,c:1,s:[2,2]}]},"5-l-tall-r-split":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:2},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:2,s:[3,2]}]},"5-213":{g:5,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-123":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"6-g3x2":{g:6,gr:[3,2]},"6-g2x3":{g:6,gr:[2,3]},"6-center":{g:6,gr:[4,4],c:[{r:1,c:3},{r:2,c:1},{r:3,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:2}]},"6-123":{g:6,gr:[3,6],c:[{r:1,c:6},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"6-321":{g:6,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:6}]},"6-231":{g:6,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:6}]},"6-222":{g:6,gr:[3,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1}]},"6-1133":{g:6,gr:[4,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"6-223r":{g:6,gr:[3,3],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-223l":{g:6,gr:[3,3],c:[{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-114":{g:6,gr:[3,5],c:[{r:2,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-3333":{g:6,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:2}]},"7-main":{g:7,gr:[4,4],c:[{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-h-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-w-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-l":{g:7,gr:[4,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-t":{g:7,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"7-311":{g:7,gr:[3,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-113":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"7-232":{g:7,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3}]},"7-124":{g:7,gr:[3,4],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-323":{g:7,gr:[3,4],c:[{r:1,c:1},{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-313":{g:7,gr:[4,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-331":{g:7,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:3},{r:1,c:1},{r:1,c:1}]},"7-233":{g:7,gr:[4,6],c:[{r:2,c:3},{r:2,c:3},{r:1,c:2},{r:2,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"7-333":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"7-346":{g:7,gr:[4,6],c:[{r:1,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:3},{r:1,c:3},{r:1,c:3}]},"8-g4x2":{g:8,gr:[4,2]},"8-g2x4":{g:8,gr:[2,4]},"8-222":{g:8,gr:[4,4],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:1,c:2}]},"8-l2-tall-r6-grid":{g:8,gr:[3,4],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-sandwich-6":{g:8,gr:[4,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]},{r:1,c:1,s:[3,3]},{r:1,c:3,s:[4,1]}]},"8-313":{g:8,gr:[5,4],c:[{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2}]},"8-131":{g:8,gr:[4,5],c:[{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"8-134":{g:8,gr:[4,4],c:[{r:3,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-431":{g:8,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:3},{r:1,c:1},{r:1,c:1}]},"8-323":{g:8,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"8-363":{g:8,gr:[6,3],c:[{r:2,c:1},{r:3,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:3,c:1},{r:2,c:1},{r:2,c:1}]},"8-344":{g:8,gr:[4,4],c:[{r:1,c:1},{r:2,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"9-grid":{g:9,gr:[3,3]},"9-144-grid":{g:9,gr:[3,4],c:[{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-414-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-441-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4}]},"9-211-grid":{g:9,gr:[3,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-112-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"9-434-grid":{g:9,gr:[4,4],c:[{r:1,c:1},{r:4,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-344-grid":{g:9,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-424-grid":{g:9,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"9-116-grid":{g:9,gr:[6,6],c:[{r:3,c:3},{r:3,c:3},{r:3,c:3},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-611-grid":{g:9,gr:[6,6],c:[{r:2,c:2},{r:1,c:1},{r:3,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:3},{r:3,c:3}]},"9-cen-grid":{g:9,gr:[4,4],c:[{r:1,c:2},{r:1,c:2},{r:2,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-g5x2":{g:10,gr:[5,2]},"10-t2b8-grid":{g:10,gr:[3,4],c:[{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-424-grid":{g:10,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-4x3-grid":{g:10,gr:[4,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-5x5-grid":{g:10,gr:[5,5],c:[{r:4,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-4x4-grid":{g:10,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"10-8x8-grid":{g:10,gr:[8,8],c:[{r:4,c:4},{r:4,c:4},{r:4,c:4},{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-442-grid":{g:10,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-6x6-grid":{g:10,gr:[6,6],c:[{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:2},{r:2,c:2},{r:2,c:2}]},"11-4c4-t":{g:11,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-4x4-t":{g:11,gr:[4,4],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1}]},"11-4x6-t":{g:11,gr:[4,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"11-feat-t":{g:11,gr:[3,5],c:[{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-c":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-f":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5}]},"12-g4x3":{g:12,gr:[4,3]},"12-g3x4":{g:12,gr:[3,4]},"12-g6x6":{g:12,gr:[6,6],c:[{r:5,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-feat-c":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-211":{g:13,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-112":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"14-g7x2":{g:14,gr:[7,2]},"14-g4x4r":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"14-g4x4c":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g5x3":{g:15,gr:[5,3]},"15-g4x4c":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g4x4f":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"16-g4x4":{g:16,gr:[4,4]}},n={currentMode:"layout",shared:{spacing:10,radius:8,bgColor:"#FFFFFF",backgroundImage:null,borderWidths:{top:10,right:10,bottom:10,left:10},downloadQuality:"high-jpg",selectedTextId:null,selectedArrowId:null,selectedRectangleId:null,selectedEllipseId:null},layout:{currentLayoutId:"2-t1b1",layoutDef:F["2-t1b1"],aspectRatio:"1/1",imagesData:{},activeCellId:null,texts:[],arrows:[],rectangles:[],ellipses:[],colFractions:[],rowFractions:[]},stitching:{direction:"horizontal",images:[],texts:[],arrows:[],rectangles:[],ellipses:[]}};function Lt(t){n.layout.currentLayoutId=t,n.layout.layoutDef=F[t]}function yt(t,e){t&&(t.shared&&Object.assign(n.shared,t.shared),e==="layout"&&t.layout?(Object.assign(n.layout,t.layout),n.layout.currentLayoutId&&Lt(n.layout.currentLayoutId)):e==="stitching"&&t.stitching&&Object.assign(n.stitching,t.stitching),console.log(`Config loaded and applied for ${e} mode.`))}const Et="collageToolAppState",St="collageToolConfig_layout",xt="collageToolConfig_stitching";function _t(t){try{localStorage.setItem(Et,JSON.stringify(t))}catch(e){console.error("Failed to save app state:",e)}}function jt(){try{const t=localStorage.getItem(Et);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load or parse app state:",t),null}}function Yt(t,e){try{const r=t==="layout"?St:xt,c=JSON.stringify(e);localStorage.setItem(r,c)}catch(r){console.error(`Failed to save config for mode "${t}":`,r)}}function vt(t){try{const e=t==="layout"?St:xt,r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(e){return console.error(`Failed to load or parse config for mode "${t}":`,e),null}}function gt(){const t=g.layoutGrid;t.querySelectorAll(".gutter").forEach(u=>u.remove());const[e,r]=n.layout.layoutDef.gr,c=t.getBoundingClientRect(),o=n.layout.rowFractions.reduce((u,a)=>u+a,0),l=n.layout.colFractions.reduce((u,a)=>u+a,0);if(r>1){const u=n.layout.colFractions.map(i=>i/l*c.width);let a=0;for(let i=0;i<r-1;i++){a+=u[i];const d=E("div","gutter gutter-v");d.style.left=`${a}px`,d.style.height="100%",d.dataset.index=i,t.appendChild(d),bt(d,"v")}}if(e>1){const u=n.layout.rowFractions.map(i=>i/o*c.height);let a=0;for(let i=0;i<e-1;i++){a+=u[i];const d=E("div","gutter gutter-h");d.style.top=`${a}px`,d.style.width="100%",d.dataset.index=i,t.appendChild(d),bt(d,"h")}}}function bt(t,e){t.onmousedown=function(r){r.preventDefault();const c=g.layoutGrid,o=parseInt(t.dataset.index),l=c.getBoundingClientRect(),u=function(i){if(e==="v"){const d=n.layout.colFractions[o]+n.layout.colFractions[o+1],s=n.layout.colFractions.slice(0,o).reduce((p,v)=>p+v/n.layout.colFractions.reduce((b,I)=>b+I,0)*l.width,0);let m=(i.clientX-l.left-s)/l.width*n.layout.colFractions.reduce((p,v)=>p+v,0);m<.1&&(m=.1);let f=d-m;f<.1&&(f=.1,m=d-.1),n.layout.colFractions[o]=m,n.layout.colFractions[o+1]=f,c.style.gridTemplateColumns=n.layout.colFractions.map(p=>`${p}fr`).join(" ")}else{const d=n.layout.rowFractions[o]+n.layout.rowFractions[o+1],s=n.layout.rowFractions.slice(0,o).reduce((p,v)=>p+v/n.layout.rowFractions.reduce((b,I)=>b+I,0)*l.height,0);let m=(i.clientY-l.top-s)/l.height*n.layout.rowFractions.reduce((p,v)=>p+v,0);m<.1&&(m=.1);let f=d-m;f<.1&&(f=.1,m=d-.1),n.layout.rowFractions[o]=m,n.layout.rowFractions[o+1]=f,c.style.gridTemplateRows=n.layout.rowFractions.map(p=>`${p}fr`).join(" ")}},a=function(){document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",a),setTimeout(gt,50)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",a)}}const Nt=Object.freeze(Object.defineProperty({__proto__:null,createGutters:gt},Symbol.toStringTag,{value:"Module"}));function st(){return n.currentMode==="layout"?n.layout:n.stitching}const G={start(t,e){t.preventDefault(),t.stopPropagation();const r=t.type.startsWith("touch"),c=r?t.touches[0]:t,o={startX:c.clientX,startY:c.clientY,initialState:e.getInitialState?e.getInitialState():{}};e.onStart&&e.onStart(o);const l=a=>{a.preventDefault();const i=a.type.startsWith("touch")?a.touches[0]:a;e.onMove&&e.onMove(i,o)},u=()=>{document.removeEventListener(r?"touchmove":"mousemove",l),document.removeEventListener(r?"touchend":"mouseup",u),e.onEnd&&e.onEnd()};document.addEventListener(r?"touchmove":"mousemove",l,{passive:!1}),document.addEventListener(r?"touchend":"mouseup",u)}};function ut(t,e){if(!e)return;const r=E("div","text-element-container");r.id=`text-container-${t.id}`,Object.assign(r.style,{top:`${t.top}%`,left:`${t.left}%`,transform:"translate(-50%, -50%)"});const c=E("div","text-content");c.innerText=t.content,c.contentEditable="true",Object.assign(c.style,{color:t.color,fontSize:`${t.fontSize}px`,whiteSpace:"nowrap"});const o=E("div","text-toolbar");o.innerHTML=`<input type="number" value="${t.fontSize}" data-property="fontSize" title="Font Size"><input type="color" value="${t.color}" data-property="color" title="Font Color">`;const l=E("button","delete-text-button");l.innerHTML="&times;",l.title="Delete Text",r.append(o,c,l),e.appendChild(r),r.addEventListener("click",s=>{s.stopPropagation(),D(t.id)});const u=s=>s.stopPropagation();o.addEventListener("mousedown",u),o.addEventListener("touchstart",u);const a=s=>{const h=s.target.dataset.property;h&&at({[h]:s.target.value})};o.addEventListener("input",a),o.addEventListener("change",a),c.addEventListener("blur",()=>at({content:c.innerText}));const i=s=>{s.stopPropagation(),s.preventDefault(),At()};l.addEventListener("click",i),l.addEventListener("touchend",i);const d=s=>{s.target.closest(".text-toolbar")||s.target.closest(".delete-text-button")||(D(t.id),G.start(s,{getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeftPercent:parseFloat(r.style.left),startTopPercent:parseFloat(r.style.top)}),onMove:(h,m)=>{const{gridRect:f,startLeftPercent:p,startTopPercent:v}=m.initialState;if(f.width===0||f.height===0)return;const b=h.clientX-m.startX,I=h.clientY-m.startY;r.style.left=`${p+b/f.width*100}%`,r.style.top=`${v+I/f.height*100}%`},onEnd:()=>{at({left:parseFloat(r.style.left),top:parseFloat(r.style.top)})}}))};r.addEventListener("mousedown",d),r.addEventListener("touchstart",d)}function ht(t,e,r=null){if(!e)return;const c=E("div","arrow-container"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","line"),u=E("div","arrow-handle"),a=E("div","arrow-handle"),i=E("div","rotation-handle"),d=E("div","text-toolbar"),s=y=>{const w=r||e.getBoundingClientRect();if(w.width===0)return;const L=w.width*(y.x1/100),S=w.height*(y.y1/100),B=w.width*(y.x2/100),x=w.height*(y.y2/100),$=Math.min(L,B),M=Math.min(S,x);Object.assign(c.style,{left:`${$}px`,top:`${M}px`,width:`${Math.abs(L-B)}px`,height:`${Math.abs(S-x)}px`,transform:`rotate(${y.rotation||0}deg)`});const Y=L-$,N=S-M;l.setAttribute("x1",Y),l.setAttribute("y1",N),l.setAttribute("x2",B-$),l.setAttribute("y2",x-M),l.setAttribute("stroke-width",y.strokeWidth),l.setAttribute("stroke",y.color),l.setAttribute("stroke-linecap","butt");const Q=o.querySelector("marker polygon");Q&&Q.setAttribute("fill",y.color),u.style.left=`${Y}px`,u.style.top=`${N}px`,a.style.left=`${B-$}px`,a.style.top=`${x-M}px`};c.id=`arrow-container-${t.id}`,n.shared.selectedArrowId===t.id&&c.classList.add("selected");const h=`arrowhead-${t.id}`;o.innerHTML=`<defs>
        <marker
            id="${h}"
            viewBox="0 0 12 12"
            refX="10" refY="6"
            markerWidth="9" markerHeight="9"
            orient="auto">
            <polygon points="2 2, 11 6, 2 10, 2 8, 5 6, 2 4" fill="${t.color}"></polygon>
        </marker>
    </defs>`,l.setAttribute("marker-end",`url(#${h})`),o.appendChild(l),d.style.top="-45px",d.innerHTML=`<input type="number" value="${t.strokeWidth}" data-property="strokeWidth" title="Thickness" min="1" max="50"><input type="color" value="${t.color}" data-property="color" title="Color"><button class="toolbar-delete-btn" title="Delete Arrow">&times;</button>`,c.append(o,u,a,i,d),e.appendChild(c),s(t);const m=(y,w)=>{y.addEventListener("mousedown",L=>G.start(L,w)),y.addEventListener("touchstart",L=>G.start(L,w))},f=y=>y.stopPropagation();d.addEventListener("mousedown",f),d.addEventListener("touchstart",f);const p=y=>{const w={[y.target.dataset.property]:y.target.value};K(w);const S=st().arrows.find(B=>B.id===t.id);S&&s(S)};d.addEventListener("input",p),d.addEventListener("change",p);const v=d.querySelector(".toolbar-delete-btn"),b=y=>{y.stopPropagation(),y.preventDefault(),Ft()};v.addEventListener("click",b),v.addEventListener("touchend",b),m(c,{onStart:()=>R(t.id),getInitialState:()=>({initialData:{...t},containerStartLeft:c.offsetLeft,containerStartTop:c.offsetTop}),onMove:(y,w)=>{const L=y.clientX-w.startX,S=y.clientY-w.startY;c.style.left=`${w.initialState.containerStartLeft+L}px`,c.style.top=`${w.initialState.containerStartTop+S}px`},onEnd:()=>{const y=c.getBoundingClientRect(),L=st().arrows.find(Q=>Q.id===t.id);if(!L)return;const S=e.getBoundingClientRect(),B=(L.x1<L.x2?L.x1:L.x2)/100*S.width,x=(L.y1<L.y2?L.y1:L.y2)/100*S.height,$=y.left-S.left-B,M=y.top-S.top-x,Y=$/S.width*100,N=M/S.height*100;(Math.abs(Y)>.01||Math.abs(N)>.01)&&K({x1:L.x1+Y,y1:L.y1+N,x2:L.x2+Y,y2:L.y2+N})}});const I=y=>({onStart:()=>R(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect()}),onMove:(w,L)=>{const{gridRect:S}=L.initialState;if(S.width===0||S.height===0)return;const x={...st().arrows.find($=>$.id===t.id)};x[y.x]=(w.clientX-S.left)/S.width*100,x[y.y]=(w.clientY-S.top)/S.height*100,K(x),s(x)},onEnd:()=>{var w;(w=k())==null||w.render()}});m(u,I({x:"x1",y:"y1"})),m(a,I({x:"x2",y:"y2"})),m(i,{onStart:()=>R(t.id),getInitialState:()=>{const y=c.getBoundingClientRect();return{centerX:y.left+y.width/2,centerY:y.top+y.height/2,initialRotation:t.rotation||0}},onMove:(y,w)=>{const{centerX:L,centerY:S,initialRotation:B}=w.initialState,x=Math.atan2(y.clientY-S,y.clientX-L)*(180/Math.PI),$=Math.atan2(w.startY-S,w.startX-L)*(180/Math.PI);c.style.transform=`rotate(${B+(x-$)}deg)`},onEnd:()=>{const y=c.style.transform,w=y?parseFloat(y.replace(/[^0-9.-]/g,"")):0;K({rotation:w})}})}function X(t,e){if(!e)return;const r=E("div","shape-container");r.id=`shape-container-${t.id}`,Object.assign(r.style,{left:`${t.left}%`,top:`${t.top}%`,width:`${t.width}%`,height:`${t.height}%`,transform:"translate(-50%, -50%)"});const c=E("div","shape-element");c.style.border=`${t.strokeWidth}px solid ${t.color}`,t.type==="ellipse"&&(c.style.borderRadius="50%");const o=E("div","shape-toolbar");o.innerHTML=`<input type="number" value="${t.strokeWidth}" data-property="strokeWidth" title="线条粗细" min="1" max="50"><input type="color" value="${t.color}" data-property="color" title="线条颜色"><button class="toolbar-delete-btn" title="删除形状">&times;</button>`;const l=["n","ne","e","se","s","sw","w","nw"].map(p=>{const v=E("div",`resize-handle ${p}`);return v.dataset.direction=p,v});r.append(c,o,...l),e.appendChild(r),(n.shared.selectedRectangleId===t.id||n.shared.selectedEllipseId===t.id)&&r.classList.add("selected");const u=t.type==="rectangle"?_:j,a=t.type==="rectangle"?Me:Re,i=t.type==="rectangle"?Dt:Wt,d=(p,v)=>{p.addEventListener("mousedown",b=>G.start(b,v)),p.addEventListener("touchstart",b=>G.start(b,v))},s=p=>p.stopPropagation();o.addEventListener("mousedown",s),o.addEventListener("touchstart",s);const h=p=>{const v=p.target.type==="number"?parseFloat(p.target.value):p.target.value,b={[p.target.dataset.property]:v};a(b),c.style.borderColor=b.color||t.color,c.style.borderWidth=b.strokeWidth?`${b.strokeWidth}px`:`${t.strokeWidth}px`};o.addEventListener("input",h),o.addEventListener("change",h);const m=o.querySelector(".toolbar-delete-btn"),f=p=>{p.stopPropagation(),p.preventDefault(),i()};m.addEventListener("click",f),m.addEventListener("touchend",f),d(c,{onStart:()=>u(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeftPercent:t.left,startTopPercent:t.top}),onMove:(p,v)=>{const{gridRect:b,startLeftPercent:I,startTopPercent:y}=v.initialState;if(b.width===0||b.height===0)return;const w=p.clientX-v.startX,L=p.clientY-v.startY;r.style.left=`${I+w/b.width*100}%`,r.style.top=`${y+L/b.height*100}%`},onEnd:()=>a({left:parseFloat(r.style.left),top:parseFloat(r.style.top)})}),l.forEach(p=>{d(p,{onStart:()=>u(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeft:t.left,startTop:t.top,startWidth:t.width,startHeight:t.height,direction:p.dataset.direction}),onMove:(v,b)=>{const{gridRect:I,direction:y,...w}=b.initialState;if(I.width===0||I.height===0)return;const L=(v.clientX-b.startX)/I.width*100,S=(v.clientY-b.startY)/I.height*100;let B=w.startLeft,x=w.startTop,$=w.startWidth,M=w.startHeight;y.includes("e")&&($+=L),y.includes("w")&&($-=L,B+=L),y.includes("s")&&(M+=S),y.includes("n")&&(M-=S,x+=S),$>1&&M>1&&(r.style.left=`${B}%`,r.style.top=`${x}%`,r.style.width=`${$}%`,r.style.height=`${M}%`)},onEnd:()=>a({left:parseFloat(r.style.left),top:parseFloat(r.style.top),width:parseFloat(r.style.width),height:parseFloat(r.style.height)})})})}function Xt(){g.layoutControls.classList.remove("hidden"),g.canvasSettings.classList.remove("hidden"),g.borderControls.classList.remove("hidden"),g.layoutWrapper.classList.remove("hidden"),g.canvasHint.classList.remove("hidden")}function Gt(){g.layoutControls.classList.add("hidden"),g.canvasSettings.classList.add("hidden"),g.layoutWrapper.classList.add("hidden"),g.canvasHint.classList.add("hidden")}function It(){const t=g.layoutGrid;t.innerHTML="";const e=n.layout.layoutDef;if(!e)return;const[r,c]=e.gr;n.layout.rowFractions=Array(r).fill(1),n.layout.colFractions=Array(c).fill(1),t.style.gridTemplateRows=n.layout.rowFractions.map(i=>`${i}fr`).join(" "),t.style.gridTemplateColumns=n.layout.colFractions.map(i=>`${i}fr`).join(" ");const o=e.c||Array.from({length:r*c},()=>({r:1,c:1})),l={...n.layout.imagesData},u={};o.forEach((i,d)=>{const s=`cell-${d}`,h=Jt(s);if(h.style.gridRowEnd=`span ${i.r}`,h.style.gridColumnEnd=`span ${i.c}`,i.s&&(h.style.gridRowStart=i.s[0],h.style.gridColumnStart=i.s[1]),t.appendChild(h),l[s]){u[s]=l[s];const m=u[s];O(s,m)}}),n.layout.imagesData=u;const a=g.layoutGrid;n.layout.texts.forEach(i=>ut(i,a)),n.layout.arrows.forEach(i=>ht(i,a)),n.layout.rectangles.forEach(i=>X(i,a)),n.layout.ellipses.forEach(i=>X(i,a)),Ct(),setTimeout(gt,100)}function et(t,e=null){var a;const r=Array.from(t).filter(i=>i.type.startsWith("image/"));if(r.length===0){C("未选择有效的图片文件","error");return}const c=(i,d)=>{const s=new FileReader;s.onload=h=>{const m=h.target.result,f=new Image;f.onload=()=>{const p={src:m,position:"50% 50%",scale:1,width:f.naturalWidth,height:f.naturalHeight};n.layout.imagesData[d]=p,O(d,p)},f.src=m},s.readAsDataURL(i)},o=[];e&&o.push(e),Array.from(document.querySelectorAll("#layout-grid .grid-cell")).map(i=>i.id).forEach(i=>{i!==e&&(!n.layout.imagesData[i]||!n.layout.imagesData[i].src)&&o.push(i)});const u=e&&((a=n.layout.imagesData[e])==null?void 0:a.src);if(o.length>0){const i=Math.min(r.length,o.length);C(`正在上传 ${i} 张图片...`,"info");let d=0;for(let s=0;s<i;s++)c(r[s],o[s]),d++;setTimeout(()=>{const s=`成功上传 ${d} 张图片。`+(r.length>d?` 已忽略 ${r.length-d} 张。`:"");C(s,"success"),A()},500)}else u?(C("画布已满，将替换当前图片。","info"),c(r[0],e)):C("没有空的格子可以放置图片","error")}function Ut(){const t=Object.entries(n.layout.imagesData);if(t.length<2)return;const e=t.map(r=>r[1]);for(let r=e.length-1;r>0;r--){const c=Math.floor(Math.random()*(r+1));[e[r],e[c]]=[e[c],e[r]]}t.forEach(([r],c)=>{n.layout.imagesData[r]=e[c],O(r,e[c])}),C("图片已随机排序","info")}function Ct(){const{spacing:t,radius:e}=n.shared,r=g.layoutGrid;r.style.gap=`${t}px`,r.querySelectorAll(".grid-cell").forEach(c=>{c.style.borderRadius=`${e}px`})}function Vt(){const e=g.layoutWrapper,r=e.offsetWidth;if(!r)return{element:document.createElement("div"),options:{},cleanup:()=>{}};const c=Math.max(1,1600/r),o=r*c,l=window.getComputedStyle(e),u=parseFloat(l.width)/parseFloat(l.height),a=o/u,i=document.createElement("div");Object.assign(i.style,{position:"absolute",top:"-9999px",left:"-9999px",width:`${o}px`,height:`${a}px`});const d=e.cloneNode(!0),s=d.querySelector("#layout-grid");s.querySelectorAll(".text-element-container, .arrow-container, .shape-container").forEach(y=>y.remove()),d.style.boxSizing="border-box",d.style.width=`${o}px`,d.style.height=`${a}px`,d.style.backgroundColor=n.shared.bgColor,d.style.backgroundImage=n.shared.backgroundImage?`url(${n.shared.backgroundImage})`:"none",d.style.backgroundSize="cover",d.style.backgroundPosition="center";const h=n.shared.borderWidths||{top:0,right:0,bottom:0,left:0};if(d.style.paddingTop=`${h.top*c}px`,d.style.paddingRight=`${h.right*c}px`,d.style.paddingBottom=`${h.bottom*c}px`,d.style.paddingLeft=`${h.left*c}px`,s){s.style.boxSizing="border-box";const{spacing:y,radius:w}=n.shared,L=y*c,S=w*c;s.style.gap=`${L}px`,s.style.display="grid",s.style.gridTemplateRows=n.layout.rowFractions.map(x=>`${x}fr`).join(" "),s.style.gridTemplateColumns=n.layout.colFractions.map(x=>`${x}fr`).join(" "),s.querySelectorAll(".grid-cell").forEach(x=>{x.style.borderRadius=`${S}px`})}const m=parseFloat(d.style.paddingLeft)||0,f=parseFloat(d.style.paddingRight)||0,p=parseFloat(d.style.paddingTop)||0,v=parseFloat(d.style.paddingBottom)||0,b={width:o-m-f,height:a-p-v};return n.layout.texts.forEach(y=>ut({...y,fontSize:y.fontSize*c},s)),n.layout.arrows.forEach(y=>ht({...y,strokeWidth:y.strokeWidth*c},s,b)),n.layout.rectangles.forEach(y=>X({...y,strokeWidth:y.strokeWidth*c},s)),n.layout.ellipses.forEach(y=>X({...y,strokeWidth:y.strokeWidth*c},s)),i.appendChild(d),document.body.appendChild(i),{element:d,options:{useCORS:!0,backgroundColor:null,scale:2},cleanup:()=>{i.parentNode===document.body?document.body.removeChild(i):console.warn("Cleanup skipped: tempContainer was not a direct child of body.")}}}function Qt(t){var e,r;t!==n.layout.currentLayoutId&&((e=g.layoutContainer.querySelector(".active"))==null||e.classList.remove("active"),(r=g.layoutContainer.querySelector(`[data-layout="${t}"]`))==null||r.classList.add("active"),Lt(t),It(),H())}function kt(t,e){if(!e)return;const r=n.layout.imagesData[t]?{...n.layout.imagesData[t]}:null,c=n.layout.imagesData[e]?{...n.layout.imagesData[e]}:null;r&&(r.position="50% 50%",r.scale=1),c&&(c.position="50% 50%",c.scale=1),n.layout.imagesData[t]=c,c?O(t,c):(delete n.layout.imagesData[t],ot(t)),n.layout.imagesData[e]=r,r?O(e,r):(delete n.layout.imagesData[e],ot(e))}function Jt(t){const e=E("div","grid-cell");e.id=t;const r=E("input");r.type="file",r.accept="image/*",r.id=`input-${t}`,r.multiple=!0,r.className="hidden-file-input",r.onchange=f=>{f.target.files.length>0&&it(f.target.files,t),f.target.value=null};const c=E("div","upload-icon-container");c.innerHTML=q.upload;const o=E("div","cell-button-container"),l=E("div","cell-icon-btn pan-toggle-btn");l.innerHTML=q.pan,l.title="切换平移/拖拽模式";const u=E("div","cell-icon-btn zoom-in-btn");u.innerHTML=q.zoomIn,u.title="放大";const a=E("div","cell-icon-btn zoom-out-btn");a.innerHTML=q.zoomOut,a.title="缩小";const i=E("div","cell-icon-btn reset-btn");i.innerHTML=q.zoomReset,i.title="还原";const d=E("div","cell-icon-btn replace-btn");d.innerHTML=q.replace,d.title="替换图片";const s=E("div","cell-icon-btn remove-btn");s.innerHTML=q.remove,s.title="删除图片";const h=(f,p)=>{const v=b=>{b.stopPropagation(),b.type==="touchend"&&b.preventDefault(),p()};f.addEventListener("click",v),f.addEventListener("touchend",v)};h(l,()=>He(t)),h(u,()=>{W(t),We()}),h(a,()=>{W(t),Oe()}),h(i,()=>qe(t)),h(d,()=>r.click()),h(s,()=>De(t)),o.append(l,d,s,u,a,i),e.append(c,r,o),e.addEventListener("wheel",f=>{var y;if(e.id!==n.layout.activeCellId||!e.classList.contains("has-image"))return;f.preventDefault(),f.stopPropagation();const p=((y=n.layout.imagesData[e.id])==null?void 0:y.scale)||1,v=.1,b=f.deltaY<0?1:-1,I=p+b*v;ct(I)},{passive:!1});const m={isPinching:!1,initialDistance:0,initialScale:1};return e.addEventListener("touchstart",f=>{var p;f.touches.length===2&&e.id===n.layout.activeCellId&&(f.preventDefault(),m.isPinching=!0,m.initialDistance=Math.hypot(f.touches[0].pageX-f.touches[1].pageX,f.touches[0].pageY-f.touches[1].pageY),m.initialScale=((p=n.layout.imagesData[e.id])==null?void 0:p.scale)||1)},{passive:!1}),e.addEventListener("touchmove",f=>{if(m.isPinching&&f.touches.length===2){f.preventDefault();const v=Math.hypot(f.touches[0].pageX-f.touches[1].pageX,f.touches[0].pageY-f.touches[1].pageY)/m.initialDistance,b=m.initialScale*v,I=Math.max(1,Math.min(b,5));e.style.backgroundSize=`${I*100}%`}},{passive:!1}),e.addEventListener("touchend",f=>{if(m.isPinching){const p=parseFloat(e.style.backgroundSize)/100;ct(p),m.isPinching=!1,m.initialDistance=0,m.initialScale=1}}),e}const Kt=Object.freeze(Object.defineProperty({__proto__:null,activate:Xt,applySharedStyles:Ct,deactivate:Gt,getDownloadOptions:Vt,processFiles:et,render:It,selectNewLayout:Qt,shuffle:Ut,swapImages:kt},Symbol.toStringTag,{value:"Module"}));let rt=!1,z=null,lt=-1;function Zt(){g.stitchingControls.classList.remove("hidden"),g.stitchingWrapper.classList.remove("hidden"),document.getElementById("stitching-placeholder").classList.toggle("hidden",n.stitching.images.length>0),ee()}function te(){g.stitchingControls.classList.add("hidden"),g.stitchingWrapper.classList.add("hidden"),g.stitchingGrid.removeEventListener("mousedown",Bt)}function tt(){const t=g.stitchingWrapper,e=g.stitchingGrid;if(n.stitching.images.length===0)t.classList.add("is-empty"),t.style.width="",t.style.height="";else{t.classList.remove("is-empty");const r=e.offsetWidth,c=e.offsetHeight;t.style.width=`${r}px`,t.style.height=`${c}px`}}function V(){const t=g.stitchingGrid,e=document.getElementById("stitching-placeholder"),r=g.stitchingWrapper;if(t.innerHTML="",n.stitching.images.length>0){e.classList.add("hidden"),r.className="collage-wrapper stitching-wrapper",t.className="collage-grid",t.classList.add(n.stitching.direction),t.style.position="relative",n.stitching.images.length>1&&t.classList.add("is-sortable");const l=[];n.stitching.images.forEach((u,a)=>{const i=E("div","stitched-image-container"),d=E("img"),s=new Promise((f,p)=>{d.onload=f,d.onerror=p});l.push(s),d.src=u,d.dataset.index=a,d.draggable=!1;const h=E("button","delete-stitched-image-btn");h.innerHTML="&times;",h.title="删除图片",h.onclick=f=>{f.stopPropagation(),we(a)};const m=E("button","add-stitched-image-btn");m.innerHTML="+",m.title="在此后插入图片",m.onclick=f=>{f.stopPropagation();const p=E("input");p.type="file",p.multiple=!0,p.accept="image/*",p.style.display="none",p.onchange=v=>{v.target.files.length>0&&Le(v.target.files,a),v.target.value=null,document.body.removeChild(p)},document.body.appendChild(p),p.click()},i.append(d,h,m),t.appendChild(i)}),Promise.all(l).then(()=>{console.log("All stitched images loaded, updating layout."),tt()}).catch(u=>{console.error("An image failed to load in stitching mode.",u),tt()})}else e.classList.remove("hidden"),t.classList.add("hidden");n.stitching.images.length===0&&tt();const c=g.stitchingGrid,o=n.stitching;o.texts.forEach(l=>ut(l,c)),o.arrows.forEach(l=>ht(l,c)),o.rectangles.forEach(l=>X(l,c)),o.ellipses.forEach(l=>X(l,c)),Tt()}function ee(){g.stitchingGrid.addEventListener("mousedown",Bt)}function Bt(t){if(t.target.tagName!=="IMG"||n.stitching.images.length<2||(t.preventDefault(),rt=!0,z=t.target.closest(".stitched-image-container"),!z))return;const e=z.querySelector("img");lt=parseInt(e.dataset.index),z.classList.add("dragging"),document.addEventListener("mousemove",$t),document.addEventListener("mouseup",Pt)}function $t(t){if(!rt)return;g.stitchingGrid.querySelectorAll(".drag-over").forEach(r=>r.classList.remove("drag-over"));const e=t.target.closest(".stitched-image-container");e&&e!==z&&e.classList.add("drag-over")}function Pt(t){if(!rt)return;z.classList.remove("dragging"),g.stitchingGrid.querySelectorAll(".drag-over").forEach(r=>r.classList.remove("drag-over"));const e=t.target.closest(".stitched-image-container");if(e&&e!==z){const r=e.querySelector("img");if(r){const c=parseInt(r.dataset.index);re(lt,c)}}rt=!1,z=null,lt=-1,document.removeEventListener("mousemove",$t),document.removeEventListener("mouseup",Pt)}function re(t,e){const[r]=n.stitching.images.splice(t,1);n.stitching.images.splice(e,0,r),V()}function Mt(t){const e=Array.from(t).filter(c=>c.type.startsWith("image/"));if(e.length===0){C("未选择有效的图片文件","error");return}document.getElementById("stitching-placeholder").classList.add("hidden");const r=e.map(c=>new Promise(o=>{const l=new FileReader;l.onload=u=>o(u.target.result),l.readAsDataURL(c)}));Promise.all(r).then(c=>{n.stitching.images=n.stitching.images.concat(c),C(`成功添加 ${c.length} 张图片`,"success"),V(),A()})}function ne(){if(!(n.stitching.images.length<2)){for(let t=n.stitching.images.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n.stitching.images[t],n.stitching.images[e]]=[n.stitching.images[e],n.stitching.images[t]]}V(),C("图片已随机排序","info")}}function Tt(){const{spacing:t,radius:e}=n.shared,r=g.stitchingGrid;r.style.gap=`${t}px`,r.querySelectorAll("img").forEach(c=>{c.style.borderRadius=`${e}px`}),requestAnimationFrame(()=>{n.stitching.images.length>0&&tt()})}function ce(){const t=g.stitchingWrapper,e=g.stitchingGrid,r=document.createElement("div"),c=e.cloneNode(!0),o=window.getComputedStyle(t);Object.assign(r.style,{padding:o.padding,backgroundColor:o.backgroundColor,backgroundImage:o.backgroundImage,backgroundSize:o.backgroundSize,backgroundPosition:o.backgroundPosition,boxSizing:"border-box",position:"absolute",top:"-9999px",left:"-9999px"}),c.style.gap=window.getComputedStyle(e).gap,r.appendChild(c),document.body.appendChild(r);const l=()=>{document.body.removeChild(r)};return{element:r,options:{useCORS:!0,backgroundColor:null,scale:3,width:r.offsetWidth,height:r.offsetHeight},cleanup:l}}function Rt(t){t!==n.stitching.direction&&(n.stitching.direction=t,document.querySelector("#stitching-direction-btns .active").classList.remove("active"),document.querySelector(`#stitching-direction-btns [data-direction="${t}"]`).classList.add("active"),V())}const oe=Object.freeze(Object.defineProperty({__proto__:null,activate:Zt,applySharedStyles:Tt,deactivate:te,getDownloadOptions:ce,processFiles:Mt,render:V,setDirection:Rt,shuffle:ne},Symbol.toStringTag,{value:"Module"})),J={layout:Kt,stitching:oe};let U=null;function k(){return U}function dt(t){if(!(n.currentMode===t&&U)){for(const e in J)if(J.hasOwnProperty(e)){const r=J[e];e===t?r.activate():r.deactivate()}n.currentMode=t,U=J[t],_t({currentMode:t}),g.layoutModeBtn.classList.toggle("active",t==="layout"),g.stitchingModeBtn.classList.toggle("active",t==="stitching"),ie(),A()}}function ie(){U&&U.render()}function se(t){var c;const e=(c=t.clipboardData)==null?void 0:c.items;if(!e)return;const r=[];for(const o of e)if(o.kind==="file"&&o.type.startsWith("image/")){const l=o.getAsFile();l&&r.push(l)}r.length>0&&(t.preventDefault(),it(r))}let nt=0;function ae(t){t.preventDefault(),t.stopPropagation(),nt++;const e=document.getElementById("drag-drop-overlay");e&&e.classList.remove("hidden")}function le(t){if(t.preventDefault(),t.stopPropagation(),nt--,nt===0){const e=document.getElementById("drag-drop-overlay");e&&e.classList.add("hidden")}}function de(t){t.preventDefault(),t.stopPropagation()}function ge(t){t.preventDefault(),t.stopPropagation();const e=document.getElementById("drag-drop-overlay");e&&e.classList.add("hidden"),nt=0;const r=t.dataTransfer.files;r.length>0&&it(r)}function ue(){window.addEventListener("paste",se),window.addEventListener("dragenter",ae,!1),window.addEventListener("dragleave",le,!1),window.addEventListener("dragover",de,!1),window.addEventListener("drop",ge,!1),console.log("Global event listeners (paste, drag & drop) initialized.")}function P(){return n.currentMode==="layout"?n.layout:n.stitching}function H(){const t=n.currentMode;let e={shared:{spacing:n.shared.spacing,radius:n.shared.radius,bgColor:n.shared.bgColor,backgroundImage:n.shared.backgroundImage,borderWidths:n.shared.borderWidths,downloadQuality:n.shared.downloadQuality}};t==="layout"?e.layout={currentLayoutId:n.layout.currentLayoutId,aspectRatio:n.layout.aspectRatio}:t==="stitching"&&(e.stitching={direction:n.stitching.direction}),Yt(t,e),console.log(`Config saved for ${t} mode.`)}function he(){window.confirm("您确定要恢复所有设置到初始状态吗？这将清除所有已保存的个性化配置，且无法撤销。")&&(localStorage.removeItem("collageToolConfig_layout"),localStorage.removeItem("collageToolConfig_stitching"),localStorage.removeItem("collageToolAppState"),C("设置已重置，正在刷新...","info"),setTimeout(()=>{window.location.reload()},1500))}function pe(){var t;(t=k())==null||t.shuffle()}function fe(t){n.shared.downloadQuality=t,H()}function me(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function ye(){const t=me();let e=null;if(t)if(e=window.open("","_blank"),e)e.document.write("<!DOCTYPE html><html><head><title>正在处理...</title><style>body{display:flex;justify-content:center;align-items:center;height:100vh;font-family:sans-serif;color:#555;}</style></head><body><h1>正在生成您的作品，请稍候...</h1></body></html>"),e.document.close();else{C("弹窗被拦截，请在浏览器设置中允许本站弹出窗口后重试","error");return}W(null),D(null),R(null),_(null),j(null);const r=k();if(!r){e&&e.close();return}g.layoutGrid.querySelectorAll(".gutter").forEach(a=>a.style.display="none"),C("正在生成高清晰度图片...","info");const{element:c,options:o,cleanup:l}=r.getDownloadOptions(),u={...o,backgroundColor:null,logging:!1};setTimeout(()=>{html2canvas(c,u).then(a=>{l&&l(),g.layoutGrid.querySelectorAll(".gutter").forEach(m=>m.style.display="block");const i=n.shared.downloadQuality;let d="image/jpeg",s=1,h="jpg";switch(i){case"high-jpg":s=.95;break;case"medium-jpg":s=.8;break;case"png":d="image/png",h="png";break}if(t&&e){const f=`
                    <!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><title>保存您的作品</title><style>body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;margin:0;background-color:#f0f2f5;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;text-align:center;padding:20px;box-sizing:border-box}.container{background-color:white;padding:25px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}p{font-size:1.1em;color:#333;margin-bottom:20px;line-height:1.5}img{max-width:100%;height:auto;border-radius:8px;border:1px solid #ddd}.highlight{color:#007aff;font-weight:600}</style></head><body><div class="container"><p>请 <span class="highlight">长按</span> 下方图片, 然后选择 <span class="highlight">“存储图像”</span> 或 <span class="highlight">“添加到‘照片’”</span></p><img src="${a.toDataURL(d,s)}" alt="拼图作品"></div></body></html>
                `;e.document.open(),e.document.write(f),e.document.close()}else a.toBlob(m=>{if(!m)return C("生成图片数据失败","error");const f=URL.createObjectURL(m),p=document.createElement("a");p.href=f,p.download=`${n.currentMode}-collage-${Date.now()}.${h}`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(f),C("下载已开始！","success")},d,s)}).catch(a=>{l&&l(),g.layoutGrid.querySelectorAll(".gutter").forEach(i=>i.style.display="block"),e&&e.close(),console.error("截图失败:",a),C("截图失败，请重试","error")})},50)}function ve(t){var e;n.currentMode!=="layout"||!t||t.classList.contains("active")||((e=g.aspectRatioBtns.querySelector(".active"))==null||e.classList.remove("active"),t.classList.add("active"),n.layout.aspectRatio=t.dataset.ratio,pt(),H(),setTimeout(()=>{var r;return(r=k())==null?void 0:r.render()},100))}function be(t){n.currentMode==="stitching"&&Rt(t),H()}function we(t){var e;n.currentMode==="stitching"&&(t>-1&&t<n.stitching.images.length&&n.stitching.images.splice(t,1),(e=k())==null||e.render(),A())}function Le(t,e){if(n.currentMode!=="stitching")return;const r=Array.from(t).filter(o=>o.type.startsWith("image/"));if(r.length===0)return;const c=r.map(o=>new Promise(l=>{const u=new FileReader;u.onload=a=>l(a.target.result),u.readAsDataURL(o)}));Promise.all(c).then(o=>{var l;n.stitching.images.splice(e+1,0,...o),C(`成功插入 ${o.length} 张图片`,"success"),(l=k())==null||l.render(),A()})}function it(t,e=null){if(!t||t.length===0)return;const r=Array.from(t).filter(c=>c.type.startsWith("image/"));if(r.length===0){C("未选择有效的图片文件","error");return}if(n.currentMode==="layout"){const c=Object.keys(n.layout.imagesData).length>0,o=r.length;if(!c&&o>0){const l=n.layout.currentLayoutId,u=F[l];if((u?u.g:0)===o){console.log(`数量匹配，使用当前已选布局: ${l}`),et(r,e);return}else if(o>1){const i=Ee(o);if(i){console.log(`自动匹配新布局: ${i}`),Se(i,r);return}}}et(r,e)}else n.currentMode==="stitching"&&Mt(r)}function Ee(t){const e=Object.entries(F),r=e.filter(([,o])=>o.g===t);if(r.length>0){const o=Math.floor(Math.random()*r.length);return r[o][0]}const c=e.filter(([,o])=>o.g>=t).sort(([,o],[,l])=>o.g-l.g);return c.length>0?c[0][0]:null}function Se(t,e){var c,o;if(n.currentMode!=="layout"||!F[t])return;(c=g.layoutContainer.querySelector(".active"))==null||c.classList.remove("active");const r=g.layoutContainer.querySelector(`[data-layout="${t}"]`);r&&r.classList.add("active"),n.layout.currentLayoutId=t,n.layout.layoutDef=F[t],n.layout.imagesData={},(o=k())==null||o.render(),setTimeout(()=>{et(e,null)},150),H()}function xe(t){var c,o;if(n.currentMode!=="layout"||n.layout.currentLayoutId===t)return;const e=Object.values(n.layout.imagesData).filter(l=>l&&l.src);(c=g.layoutContainer.querySelector(".active"))==null||c.classList.remove("active");const r=g.layoutContainer.querySelector(`[data-layout="${t}"]`);r&&r.classList.add("active"),n.layout.currentLayoutId=t,n.layout.layoutDef=F[t],n.layout.imagesData={},(o=k())==null||o.render(),e.length>0&&setTimeout(()=>{const l=document.querySelectorAll("#layout-grid .grid-cell"),u={},a=Math.min(l.length,e.length);for(let i=0;i<a;i++){const d=l[i].id,s=e[i];u[d]=s,O(d,s)}n.layout.imagesData=u,A()},100),H()}function Ie(t){const e=new FileReader;e.onload=r=>{n.shared.backgroundImage=r.target.result,T()},e.readAsDataURL(t),H()}function Ce(){n.shared.backgroundImage=null,T()}function ke(){var o;const t=P(),r=window.innerWidth<768?16:24,c={id:Date.now(),content:"文字",color:"#ff0000",fontSize:r,top:30,left:30};t.texts.push(c),(o=k())==null||o.render(),D(c.id)}function D(t){var r;if(n.shared.selectedTextId===t)return;const e=n.shared.selectedTextId;if(n.shared.selectedTextId=t,e&&((r=document.getElementById(`text-container-${e}`))==null||r.classList.remove("selected")),t){const c=document.getElementById(`text-container-${t}`);if(c){c.classList.add("selected");const o=c.querySelector(".text-content");Be(o)}}}function at(t){if(!n.shared.selectedTextId)return;const e=P().texts.find(o=>o.id===n.shared.selectedTextId);if(!e)return;Object.assign(e,t);const r=document.getElementById(`text-container-${e.id}`);if(!r)return;const c=r.querySelector(".text-content");c&&(t.content&&(c.innerText=t.content),t.fontSize&&(c.style.fontSize=`${t.fontSize}px`),t.color&&(c.style.color=t.color),t.top&&(c.style.top=`${t.top}%`),t.left&&(c.style.left=`${t.left}%`))}function At(){var r;if(!n.shared.selectedTextId)return;const t=P(),e=t.texts.findIndex(c=>c.id===n.shared.selectedTextId);e>-1&&(t.texts.splice(e,1),(r=document.getElementById(`text-container-${n.shared.selectedTextId}`))==null||r.remove(),D(null))}function Be(t){if(t&&(t.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u")){const e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const r=window.getSelection();r.removeAllRanges(),r.addRange(e)}}function $e(){var o;const t=P(),e=window.innerWidth<768,r={strokeWidth:e?4:3,x1:e?20:25,y1:25,x2:e?45:35,y2:35},c={id:Date.now(),color:"#ff0000",rotation:0,...r};t.arrows.push(c),(o=k())==null||o.render(),R(c.id)}function R(t){var r,c;if(n.shared.selectedArrowId===t&&t!==null)return;const e=n.shared.selectedArrowId;n.shared.selectedArrowId=t,e&&((r=document.getElementById(`arrow-container-${e}`))==null||r.classList.remove("selected")),t&&((c=document.getElementById(`arrow-container-${t}`))==null||c.classList.add("selected"))}function K(t){if(!n.shared.selectedArrowId)return;const e=P().arrows.find(r=>r.id===n.shared.selectedArrowId);e&&Object.assign(e,t)}function Ft(){var r;if(!n.shared.selectedArrowId)return;const t=P(),e=t.arrows.findIndex(c=>c.id===n.shared.selectedArrowId);e>-1&&(t.arrows.splice(e,1),(r=k())==null||r.render(),R(null))}function Pe(){var c;const t=P(),e=window.innerWidth<768,r={id:Date.now(),type:"rectangle",color:"#ff0000",strokeWidth:4,left:30,top:30,width:e?20:15,height:e?15:10,rotation:0};t.rectangles.push(r),(c=k())==null||c.render(),_(r.id)}function _(t){var r,c;if(n.shared.selectedRectangleId===t)return;D(null),R(null),j(null);const e=n.shared.selectedRectangleId;n.shared.selectedRectangleId=t,e&&((r=document.getElementById(`shape-container-${e}`))==null||r.classList.remove("selected")),t&&((c=document.getElementById(`shape-container-${t}`))==null||c.classList.add("selected"))}function Me(t){if(!n.shared.selectedRectangleId)return;const e=P().rectangles.find(r=>r.id===n.shared.selectedRectangleId);e&&Object.assign(e,t)}function Dt(){var r;if(!n.shared.selectedRectangleId)return;const t=P(),e=t.rectangles.findIndex(c=>c.id===n.shared.selectedRectangleId);e>-1&&(t.rectangles.splice(e,1),(r=k())==null||r.render(),_(null))}function Te(){var c;const t=P(),e=window.innerWidth<768,r={id:Date.now(),type:"ellipse",color:"#ff0000",strokeWidth:4,left:30,top:30,width:e?20:15,height:e?20:15,rotation:0};t.ellipses.push(r),(c=k())==null||c.render(),j(r.id)}function j(t){var r,c;if(n.shared.selectedEllipseId===t)return;D(null),R(null),_(null);const e=n.shared.selectedEllipseId;n.shared.selectedEllipseId=t,e&&((r=document.getElementById(`shape-container-${e}`))==null||r.classList.remove("selected")),t&&((c=document.getElementById(`shape-container-${t}`))==null||c.classList.add("selected"))}function Re(t){if(!n.shared.selectedEllipseId)return;const e=P().ellipses.find(r=>r.id===n.shared.selectedEllipseId);e&&Object.assign(e,t)}function Wt(){var r;if(!n.shared.selectedEllipseId)return;const t=P(),e=t.ellipses.findIndex(c=>c.id===n.shared.selectedEllipseId);e>-1&&(t.ellipses.splice(e,1),(r=k())==null||r.render(),j(null))}function W(t){if(n.currentMode==="layout"&&n.layout.activeCellId!==t){if(n.layout.activeCellId){const e=document.getElementById(n.layout.activeCellId);e&&e.classList.remove("selected")}if(n.layout.activeCellId=t,t){const e=document.getElementById(t);e&&e.classList.add("selected")}}}function Ae(t){if(typeof t!="string"||t.trim()==="")return[50,50];const e=t.split(" "),r=parseFloat(e[0]),c=e.length>1?parseFloat(e[1]):r;return[isNaN(r)?50:r,isNaN(c)?50:c]}function Fe(t,e){if(n.currentMode!=="layout")return;const{activeCellId:r}=n.layout;if(!r)return;const c=n.layout.imagesData[r];if(!c||!c.src)return;const o=document.getElementById(r);if(!o)return;const[l,u]=Ae(c.position);let a=l-t,i=u-e;a=Math.max(0,Math.min(100,a)),i=Math.max(0,Math.min(100,i));const d=`${a}% ${i}%`;c.position=d,o.style.backgroundPosition=d}function ct(t){if(n.currentMode!=="layout")return;const{activeCellId:e}=n.layout;if(!e)return;const r=n.layout.imagesData[e];if(!r||!r.src)return;const c=Math.max(1,Math.min(t,5));r.scale=c,O(e,r)}function De(t){n.currentMode==="layout"&&(delete n.layout.imagesData[t],ot(t),W(null),A())}const Ot=.2;function We(){if(n.currentMode!=="layout")return;const{activeCellId:t}=n.layout;if(!t||!n.layout.imagesData[t])return;const r=(n.layout.imagesData[t].scale||1)+Ot;ct(r)}function Oe(){if(n.currentMode!=="layout")return;const{activeCellId:t}=n.layout;if(!t||!n.layout.imagesData[t])return;const r=(n.layout.imagesData[t].scale||1)-Ot;ct(r)}function qe(t){if(n.currentMode!=="layout")return;const e=n.layout.imagesData[t];e&&(e.scale=1,e.position="50% 50%",O(t,e))}function ze(){const t=document.querySelector(".grid-cell.is-panning-touch");t&&t.classList.remove("is-panning-touch")}function He(t){const e=document.getElementById(t);if(!e)return;const r=document.querySelector(".grid-cell.is-panning-touch");r&&r.id!==t&&r.classList.remove("is-panning-touch"),e.classList.toggle("is-panning-touch"),e.classList.contains("is-panning-touch")?W(t):W(null)}function _e(){var e;if(!confirm("您确定要清空整个画布吗？所有未保存的更改都将丢失。"))return;const t=P();t.texts=[],t.arrows=[],t.rectangles=[],t.ellipses=[],n.currentMode==="layout"?t.imagesData={}:n.currentMode==="stitching"&&(t.images=[]),W(null),D(null),R(null),_(null),j(null),(e=k())==null||e.render(),A(),C("画布已清空","info")}let wt;function C(t,e="info",r=3e3){const c=document.getElementById("toast");c&&(clearTimeout(wt),c.textContent=t,c.className="toast",c.classList.add(e),c.classList.add("show"),wt=setTimeout(()=>{c.classList.remove("show")},r))}const Z=t=>{const e=parseInt(t.value,10);return isNaN(e)||e<0?0:e};function T(){var s;const t=g.spacingSlider.value,e=g.radiusSlider.value,r=g.colorPicker.value,c=Z(g.borderTopInput),o=Z(g.borderRightInput),l=Z(g.borderBottomInput),u=Z(g.borderLeftInput);n.shared.spacing=t,n.shared.radius=e,n.shared.bgColor=r,n.shared.borderWidths={top:c,right:o,bottom:l,left:u},g.spacingValue.textContent=t,g.radiusValue.textContent=e;const a=g.layoutWrapper;n.shared.backgroundImage?(a.style.backgroundImage=`url(${n.shared.backgroundImage})`,a.style.backgroundSize="cover",a.style.backgroundPosition="center"):(a.style.backgroundImage="none",a.style.backgroundColor=n.shared.bgColor),a.style.paddingTop=`${n.shared.borderWidths.top}px`,a.style.paddingRight=`${n.shared.borderWidths.right}px`,a.style.paddingBottom=`${n.shared.borderWidths.bottom}px`,a.style.paddingLeft=`${n.shared.borderWidths.left}px`;const i=g.stitchingWrapper,d=g.stitchingGrid;n.shared.backgroundImage?(i.style.backgroundImage=`url(${n.shared.backgroundImage})`,i.style.backgroundSize="cover",i.style.backgroundPosition="center"):(i.style.backgroundImage="none",i.style.backgroundColor=n.shared.bgColor),i.style.padding="0",d.style.paddingTop=`${n.shared.borderWidths.top}px`,d.style.paddingRight=`${n.shared.borderWidths.right}px`,d.style.paddingBottom=`${n.shared.borderWidths.bottom}px`,d.style.paddingLeft=`${n.shared.borderWidths.left}px`,(s=k())==null||s.applySharedStyles(),n.currentMode==="stitching"&&requestAnimationFrame(()=>{const h=k();h&&typeof h.updateLayout=="function"&&h.updateLayout()}),H()}function O(t,e){const r=document.getElementById(t);if(!r||!e||!e.src)return;r.style.backgroundImage=`url('${e.src}')`,r.style.backgroundPosition=e.position,r.classList.add("has-image");const c=r.querySelector(".upload-icon-container");c&&(c.style.display="none");const o=r.clientWidth,l=r.clientHeight;if(!e.width||!e.height||!o||!l){r.style.backgroundSize="cover";return}const u=o/l,a=e.width/e.height,i=e.scale||1;let d;a>u?d=`auto ${i*100}%`:d=`${i*100}% auto`,r.style.backgroundSize=d}function ot(t){const e=document.getElementById(t);if(!e)return;e.style.backgroundImage="none",e.classList.remove("has-image");const r=e.querySelector(".upload-icon-container");r&&(r.style.display="flex")}function A(){let t=0;n.currentMode==="layout"?t=Object.keys(n.layout.imagesData).length:t=n.stitching.images.length,g.shuffleBtn.disabled=t<2}function pt(){const t=document.getElementById("center-content"),e=document.getElementById("layout-wrapper"),r=document.getElementById("aspect-ratio-btns"),c=document.getElementById("canvas-action-toolbar");if(!t||!e||!r||!c){console.error("无法找到布局容器或工具栏元素，计算中止。");return}const o=window.getComputedStyle(t),l=parseFloat(o.paddingLeft)+parseFloat(o.paddingRight),u=parseFloat(o.paddingTop)+parseFloat(o.paddingBottom),a=t.clientWidth-l;let i=t.clientHeight-u;const d=window.getComputedStyle(c),s=c.offsetHeight+parseFloat(d.marginBottom);i-=s;const h=r.querySelector(".active");if(!h)return;const m=h.dataset.ratio.split("/"),f=parseFloat(m[0])/parseFloat(m[1]);let p,v;a/i>f?(v=i,p=v*f):(p=a,v=p/f),e.style.width=`${p}px`,e.style.height=`${v}px`,c.style.width=`${p}px`}const je=Object.freeze(Object.defineProperty({__proto__:null,applyCanvasStyles:T,applyImageToCell:O,clearImageFromCell:ot,showToast:C,updateCanvasSize:pt,updateShuffleButton:A},Symbol.toStringTag,{value:"Module"}));(function(){const t="img.ops-coffee.cn",e=window.location.hostname;e&&e!==t&&e!=="localhost"&&(window.location.href=`https://${t}`)})();function Ye(){g.layoutContainer.innerHTML="";const t={};for(const e in F){const r=F[e];t[r.g]||(t[r.g]=[]),t[r.g].push({id:e,...r})}Object.keys(t).sort((e,r)=>e-r).forEach(e=>{const r=E("h4","layout-group-title");r.textContent=`${e} 张图片`,g.layoutContainer.appendChild(r);const c=E("div","layout-thumbnail-grid");t[e].forEach(o=>{const l=Ne(o.id,o);o.id===n.layout.currentLayoutId&&l.classList.add("active"),c.appendChild(l)}),g.layoutContainer.appendChild(c)})}function Ne(t,e){const r=E("div","layout-thumbnail");r.dataset.layout=t;const c=E("div","thumbnail-grid");return c.style.gridTemplateColumns=`repeat(${e.gr[1]}, 1fr)`,c.style.gridTemplateRows=`repeat(${e.gr[0]}, 1fr)`,(e.c||Array.from({length:e.gr[0]*e.gr[1]},()=>({r:1,c:1}))).forEach(l=>{const u=E("div","thumbnail-cell");u.style.gridRowEnd=`span ${l.r}`,u.style.gridColumnEnd=`span ${l.c}`,l.s&&(u.style.gridRowStart=l.s[0],u.style.gridColumnStart=l.s[1]),c.appendChild(u)}),r.appendChild(c),r}function Xe(){g.layoutModeBtn.addEventListener("click",()=>dt("layout")),g.stitchingModeBtn.addEventListener("click",()=>dt("stitching")),g.stitchingUploadBtn.addEventListener("click",()=>g.stitchingUploadInput.click()),g.stitchingUploadInput.addEventListener("change",s=>{it(s.target.files),s.target.value=null}),g.stitchingDirectionBtns.addEventListener("click",s=>{const h=s.target.closest("button");h&&be(h.dataset.direction)}),g.layoutContainer.addEventListener("click",s=>{const h=s.target.closest(".layout-thumbnail");h&&(xe(h.dataset.layout),document.getElementById("left-sidebar").classList.contains("is-open")&&document.getElementById("mobile-overlay").click())}),g.aspectRatioBtns.addEventListener("click",s=>{const h=s.target.closest("button");h&&ve(h)}),g.spacingSlider.addEventListener("input",T),g.radiusSlider.addEventListener("input",T),g.borderTopInput.addEventListener("input",T),g.borderRightInput.addEventListener("input",T),g.borderBottomInput.addEventListener("input",T),g.borderLeftInput.addEventListener("input",T),g.colorPicker.addEventListener("input",T),g.downloadBtn.addEventListener("click",ye);const t=document.getElementById("bg-upload-input");document.getElementById("upload-bg-btn").addEventListener("click",()=>t.click()),t.addEventListener("change",s=>{s.target.files&&s.target.files[0]&&Ie(s.target.files[0]),s.target.value=null}),document.getElementById("remove-bg-btn").addEventListener("click",Ce),document.getElementById("add-text-btn").addEventListener("click",ke),document.getElementById("add-arrow-btn").addEventListener("click",$e),document.getElementById("add-rectangle-btn").addEventListener("click",Pe),document.getElementById("add-ellipse-btn").addEventListener("click",Te),document.getElementById("shuffle-btn").addEventListener("click",pe),document.getElementById("clear-canvas-btn").addEventListener("click",_e);let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{n.currentMode==="layout"&&(mt(async()=>{const{updateCanvasSize:s}=await Promise.resolve().then(()=>je);return{updateCanvasSize:s}},void 0).then(({updateCanvasSize:s})=>s()),mt(async()=>{const{createGutters:s}=await Promise.resolve().then(()=>Nt);return{createGutters:s}},void 0).then(({createGutters:s})=>s()))},150)});const r=document.getElementById("left-sidebar"),c=document.getElementById("right-sidebar"),o=document.getElementById("mobile-overlay"),l=()=>{r.classList.remove("is-open"),c.classList.remove("is-open"),o.classList.add("hidden"),document.body.classList.remove("sidebar-open")};document.getElementById("toggle-left-sidebar").addEventListener("click",s=>{s.stopPropagation(),r.classList.toggle("is-open")?(c.classList.remove("is-open"),o.classList.remove("hidden"),document.body.classList.add("sidebar-open")):l()}),document.getElementById("toggle-right-sidebar").addEventListener("click",s=>{s.stopPropagation(),c.classList.toggle("is-open")?(r.classList.remove("is-open"),o.classList.remove("hidden"),document.body.classList.add("sidebar-open")):l()}),o.addEventListener("click",l);const u=document.getElementById("app-container");document.getElementById("pc-toggle-left").addEventListener("click",()=>u.classList.toggle("left-sidebar-collapsed")),document.getElementById("pc-toggle-right").addEventListener("click",()=>u.classList.toggle("right-sidebar-collapsed")),document.getElementById("stitching-placeholder").addEventListener("click",()=>g.stitchingUploadInput.click()),Ge(),document.addEventListener("click",s=>{const h=s.target,m=h.closest(".grid-cell, .text-element-container, .arrow-container, .shape-container"),f=h.closest("#right-sidebar"),p=h.closest("#canvas-action-toolbar"),v=document.querySelector(".grid-cell.is-panning-touch");v&&(h.closest(".pan-toggle-btn")&&v.contains(h)||ze()),!(m||f||p)&&(W(null),D(null),R(null),_(null),j(null))}),document.addEventListener("keydown",s=>{const h=s.target;if(!(h.isContentEditable||h.tagName==="INPUT"||h.tagName==="TEXTAREA")){if(s.key==="Delete"||s.key==="Backspace"){s.preventDefault(),n.shared.selectedTextId?At():n.shared.selectedArrowId?Ft():n.shared.selectedRectangleId?Dt():n.shared.selectedEllipseId&&Wt();return}if(n.currentMode==="layout"&&n.layout.activeCellId){let f=0,p=0;switch(s.key){case"ArrowUp":p=-1.5;break;case"ArrowDown":p=1.5;break;case"ArrowLeft":f=-1.5;break;case"ArrowRight":f=1.5;break;default:return}s.preventDefault(),Fe(f,p)}}});const a=document.getElementById("layout-wrapper"),i=document.getElementById("canvas-hint");a&&i&&(a.addEventListener("mouseenter",()=>{n.currentMode==="layout"&&i.classList.add("is-visible")}),a.addEventListener("mouseleave",()=>{i.classList.remove("is-visible")}));const d=document.getElementById("reset-settings-btn");d&&(d.innerHTML=q.reset,d.addEventListener("click",he))}function Ge(){const t=document.getElementById("layout-grid");if(!t)return;let e={};const r=()=>{if(e.isPanning&&e.activeCell.classList.remove("is-panning"),e.isDragging){e.startCell.classList.remove("dragging");const a=document.querySelector(".grid-cell.drag-over");a&&a.classList.remove("drag-over")}e={},document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u),document.removeEventListener("touchmove",l,{passive:!1}),document.removeEventListener("touchend",u)},c=(a,i)=>{if(typeof a!="string")return 50;const d=a.trim();if(d.endsWith("%"))return parseFloat(d);if(d.endsWith("px"))return parseFloat(d)/i*100;switch(d){case"top":case"left":return 0;case"bottom":case"right":return 100;case"center":return 50}return 50},o=a=>{if(a.target.isContentEditable||a.target.closest(".text-element-container, .arrow-container, .shape-container"))return;const i=a.touches?a.touches[0]:a,d=i.target.closest(".grid-cell");d&&(a.type==="touchstart"&&a.preventDefault(),r(),e.isMouseDown=!0,e.startCell=d,e.startX=i.clientX,e.startY=i.clientY,document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchend",u))},l=a=>{var d,s;if(!e.isMouseDown)return;a.type==="touchmove"&&a.preventDefault();const i=a.touches?a.touches[0]:a;if(e.isPanning){const h=e.activeCell.getBoundingClientRect(),m=(i.clientX-e.startX)/h.width*100,f=(i.clientY-e.startY)/h.height*100;let p=e.startBgPercentX-m,v=e.startBgPercentY-f;e.activeCell.style.backgroundPosition=`${p}% ${v}%`;return}if(e.isDragging){const h=(d=document.elementFromPoint(i.clientX,i.clientY))==null?void 0:d.closest(".grid-cell"),m=document.querySelector(".grid-cell.drag-over");h!==m&&(m&&m.classList.remove("drag-over"),h&&h!==e.startCell&&h.classList.add("drag-over"));return}if(!e.hasMoved&&(Math.abs(i.clientX-e.startX)>5||Math.abs(i.clientY-e.startY)>5))if(e.hasMoved=!0,(a.altKey||e.startCell.classList.contains("is-panning-touch"))&&e.startCell.classList.contains("has-image")){e.isPanning=!0,e.activeCell=e.startCell,e.activeCell.classList.add("is-panning");const h=e.activeCell.id,f=(((s=n.layout.imagesData[h])==null?void 0:s.position)||"50% 50%").split(" "),p=e.activeCell.getBoundingClientRect();e.startBgPercentX=c(f[0],p.width),e.startBgPercentY=c(f.length>1?f[1]:f[0],p.height)}else e.startCell.classList.contains("has-image")&&(e.isDragging=!0,e.startCell.classList.add("dragging"))},u=a=>{var d;if(!e.isMouseDown)return;const i=a.changedTouches?a.changedTouches[0]:a;if(e.isPanning){const s=e.activeCell.id;n.layout.imagesData[s]&&(n.layout.imagesData[s].position=e.activeCell.style.backgroundPosition)}else if(e.isDragging){const s=(d=document.elementFromPoint(i.clientX,i.clientY))==null?void 0:d.closest(".grid-cell");s&&s!==e.startCell&&kt(e.startCell.id,s.id)}else if(!e.hasMoved)if(e.startCell.classList.contains("has-image"))W(e.startCell.id);else{const s=e.startCell.querySelector('input[type="file"]');s&&s.click()}r()};t.addEventListener("mousedown",o),t.addEventListener("touchstart",o,{passive:!1})}function Ue(){var c;const t=document.getElementById("quality-selector");if(!t)return;const e=n.shared.downloadQuality,r=t.querySelector(`[data-quality="${e}"]`);r&&((c=t.querySelector(".active"))==null||c.classList.remove("active"),r.classList.add("active")),t.addEventListener("click",o=>{var u;const l=o.target.closest("button");!l||!l.dataset.quality||((u=t.querySelector(".active"))==null||u.classList.remove("active"),l.classList.add("active"),fe(l.dataset.quality))})}function Ve(){if(navigator.userAgent.toLowerCase().includes("micromessenger")){const r=document.getElementById("wechat-overlay");r&&r.classList.remove("hidden")}}function Qe(){const t=navigator.userAgent,e=navigator.platform;(/iPad/.test(t)||e==="MacIntel"&&navigator.maxTouchPoints>1)&&(document.body.classList.add("is-ipad"),console.log("iPad device detected. Applying specific fixes."))}function Je(){var e,r,c;if(g.spacingSlider.value=n.shared.spacing,g.radiusSlider.value=n.shared.radius,g.colorPicker.value=n.shared.bgColor,g.spacingValue&&(g.spacingValue.textContent=n.shared.spacing),g.radiusValue&&(g.radiusValue.textContent=n.shared.radius),n.shared.borderWidths&&(g.borderTopInput.value=n.shared.borderWidths.top,g.borderRightInput.value=n.shared.borderWidths.right,g.borderBottomInput.value=n.shared.borderWidths.bottom,g.borderLeftInput.value=n.shared.borderWidths.left),g.aspectRatioBtns){const o=g.aspectRatioBtns.querySelector(`[data-ratio="${n.layout.aspectRatio}"]`);o&&((e=g.aspectRatioBtns.querySelector(".active"))==null||e.classList.remove("active"),o.classList.add("active"))}const t=document.getElementById("quality-selector");if(t){const o=t.querySelector(`[data-quality="${n.shared.downloadQuality}"]`);o&&((r=t.querySelector(".active"))==null||r.classList.remove("active"),o.classList.add("active"))}if(g.stitchingDirectionBtns){const o=g.stitchingDirectionBtns.querySelector(`[data-direction="${n.stitching.direction}"]`);o&&((c=g.stitchingDirectionBtns.querySelector(".active"))==null||c.classList.remove("active"),o.classList.add("active"))}}function Ke(){const t=jt();t&&t.currentMode&&(n.currentMode=t.currentMode);const e=vt("layout");e&&yt(e,"layout");const r=vt("stitching");r&&yt(r,"stitching"),Ht(),Xe(),Je(),dt(n.currentMode),T(),pt(),Ye(),A(),Ue(),Qe(),Ve(),ue(),console.log("%c 免费在线拼图工具 %c by ops-coffee.cn ","background: #0052cc; color: #fff; padding: 5px; border-radius: 5px 0 0 5px;","background: #f4f5f7; color: #42526e; padding: 5px; border-radius: 0 5px 5px 0;"),console.log("感谢使用！如果您对这个工具有任何建议，欢迎联系我们。微信公众号搜索：运维咖啡吧")}document.addEventListener("DOMContentLoaded",Ke);
