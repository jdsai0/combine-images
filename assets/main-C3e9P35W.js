const $t="modulepreload",Pt=function(t){return"/"+t},lt={},dt=function(e,r,c){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),o=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));s=Promise.allSettled(r.map(i=>{if(i=Pt(i),i in lt)return;lt[i]=!0;const a=i.endsWith(".css"),d=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const g=document.createElement("link");if(g.rel=a?"stylesheet":$t,a||(g.as="script"),g.crossOrigin="",g.href=i,o&&g.setAttribute("nonce",o),document.head.appendChild(g),a)return new Promise((f,v)=>{g.addEventListener("load",f),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${i}`)))})}))}function l(u){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=u,window.dispatchEvent(o),!o.defaultPrevented)throw u}return s.then(u=>{for(const o of u||[])o.status==="rejected"&&l(o.reason);return e().catch(l)})},p={};function Mt(){Object.assign(p,{layoutModeBtn:document.getElementById("layout-mode-btn"),stitchingModeBtn:document.getElementById("stitching-mode-btn"),layoutControls:document.getElementById("layout-controls"),layoutContainer:document.getElementById("layout-container"),stitchingControls:document.getElementById("stitching-controls"),stitchingDirectionBtns:document.getElementById("stitching-direction-btns"),stitchingUploadBtn:document.getElementById("stitching-upload-btn"),stitchingUploadInput:document.getElementById("stitching-upload-input"),layoutWrapper:document.getElementById("layout-wrapper"),layoutGrid:document.getElementById("layout-grid"),stitchingWrapper:document.getElementById("stitching-wrapper"),stitchingGrid:document.getElementById("stitching-grid"),canvasHint:document.getElementById("canvas-hint"),canvasSettings:document.getElementById("canvas-settings"),aspectRatioBtns:document.getElementById("aspect-ratio-btns"),spacingSlider:document.getElementById("spacing-slider"),spacingValue:document.getElementById("spacing-value"),radiusSlider:document.getElementById("radius-slider"),radiusValue:document.getElementById("radius-value"),colorPicker:document.getElementById("color-picker"),shuffleBtn:document.getElementById("shuffle-btn"),downloadBtn:document.getElementById("download-btn"),borderTopInput:document.getElementById("border-top-input"),borderRightInput:document.getElementById("border-right-input"),borderBottomInput:document.getElementById("border-bottom-input"),borderLeftInput:document.getElementById("border-left-input"),borderControls:document.getElementById("border-controls"),toast:document.getElementById("toast")})}function w(t,e){const r=document.createElement(t);return e&&(r.className=e),r}const q={upload:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',remove:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',replace:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>',zoomIn:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',zoomOut:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>',zoomReset:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="4"></circle></svg>'},Z={"2-t1b1":{g:2,gr:[2,1],c:[{r:1,c:1},{r:1,c:1}]},"2-l1r1":{g:2,gr:[1,2],c:[{r:1,c:1},{r:1,c:1}]},"3-t1b2":{g:3,gr:[2,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"3-t2b1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"3-l1r2":{g:3,gr:[2,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"3-l2r1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"3-l1rr":{g:3,gr:[3,3],c:[{r:3,c:2},{r:1,c:1},{r:2,c:1}]},"3-t1bb":{g:3,gr:[3,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:2}]},"4-grid":{g:4,gr:[2,2]},"4-t1b3":{g:4,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-b1t3":{g:4,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"4-l1r3":{g:4,gr:[3,2],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-l-feat":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"4-r-feat":{g:4,gr:[2,3],c:[{r:1,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1,s:[2,1]}]},"4-121":{g:4,gr:[3,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"4-212":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"4-g3x2-alt":{g:4,gr:[3,2],c:[{r:2,c:1},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[1,2]},{r:2,c:1,s:[2,2]}]},"5-center":{g:5,gr:[3,3],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:2}]},"5-l3r2":{g:5,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"5-131":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1}]},"5-l2r3":{g:5,gr:[3,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t2b3":{g:5,gr:[2,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-center-h-bar":{g:5,gr:[3,2],c:[{r:1,c:1},{r:1,c:1,s:[1,2]},{r:1,c:2,s:[2,1]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-t2b3-split":{g:5,gr:[2,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"5-l1r4-col":{g:5,gr:[4,2],c:[{r:4,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t-feat-r":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t1b4-grid":{g:5,gr:[3,2],c:[{r:1,c:2},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-r1l4-col":{g:5,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:4,c:1,s:[1,2]}]},"5-cross-center":{g:5,gr:[3,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:3,s:[3,1]},{r:1,c:1,s:[2,2]}]},"5-l-tall-r-split":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:2},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:2,s:[3,2]}]},"5-213":{g:5,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-123":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"6-g3x2":{g:6,gr:[3,2]},"6-g2x3":{g:6,gr:[2,3]},"6-center":{g:6,gr:[4,4],c:[{r:1,c:3},{r:2,c:1},{r:3,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:2}]},"6-123":{g:6,gr:[3,6],c:[{r:1,c:6},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"6-321":{g:6,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:6}]},"6-231":{g:6,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:6}]},"6-222":{g:6,gr:[3,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1}]},"6-1133":{g:6,gr:[4,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"6-223r":{g:6,gr:[3,3],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-223l":{g:6,gr:[3,3],c:[{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-114":{g:6,gr:[3,5],c:[{r:2,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-3333":{g:6,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:2}]},"7-main":{g:7,gr:[4,4],c:[{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-h-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-w-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-l":{g:7,gr:[4,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-t":{g:7,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"7-311":{g:7,gr:[3,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-113":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"7-232":{g:7,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3}]},"7-124":{g:7,gr:[3,4],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-323":{g:7,gr:[3,4],c:[{r:1,c:1},{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-313":{g:7,gr:[4,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-331":{g:7,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:3},{r:1,c:1},{r:1,c:1}]},"7-233":{g:7,gr:[4,6],c:[{r:2,c:3},{r:2,c:3},{r:1,c:2},{r:2,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"7-333":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"7-346":{g:7,gr:[4,6],c:[{r:1,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:3},{r:1,c:3},{r:1,c:3}]},"8-g4x2":{g:8,gr:[4,2]},"8-g2x4":{g:8,gr:[2,4]},"8-222":{g:8,gr:[4,4],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:1,c:2}]},"8-l2-tall-r6-grid":{g:8,gr:[3,4],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-sandwich-6":{g:8,gr:[4,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]},{r:1,c:1,s:[3,3]},{r:1,c:3,s:[4,1]}]},"8-313":{g:8,gr:[5,4],c:[{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2}]},"8-131":{g:8,gr:[4,5],c:[{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"8-134":{g:8,gr:[4,4],c:[{r:3,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-431":{g:8,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:3},{r:1,c:1},{r:1,c:1}]},"8-323":{g:8,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"8-363":{g:8,gr:[6,3],c:[{r:2,c:1},{r:3,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:3,c:1},{r:2,c:1},{r:2,c:1}]},"8-344":{g:8,gr:[4,4],c:[{r:1,c:1},{r:2,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"9-grid":{g:9,gr:[3,3]},"9-144-grid":{g:9,gr:[3,4],c:[{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-414-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-441-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4}]},"9-211-grid":{g:9,gr:[3,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-112-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"9-434-grid":{g:9,gr:[4,4],c:[{r:1,c:1},{r:4,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-344-grid":{g:9,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-424-grid":{g:9,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"9-116-grid":{g:9,gr:[6,6],c:[{r:3,c:3},{r:3,c:3},{r:3,c:3},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-611-grid":{g:9,gr:[6,6],c:[{r:2,c:2},{r:1,c:1},{r:3,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:3},{r:3,c:3}]},"9-cen-grid":{g:9,gr:[4,4],c:[{r:1,c:2},{r:1,c:2},{r:2,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-g5x2":{g:10,gr:[5,2]},"10-t2b8-grid":{g:10,gr:[3,4],c:[{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-424-grid":{g:10,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-4x3-grid":{g:10,gr:[4,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-5x5-grid":{g:10,gr:[5,5],c:[{r:4,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-4x4-grid":{g:10,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"10-8x8-grid":{g:10,gr:[8,8],c:[{r:4,c:4},{r:4,c:4},{r:4,c:4},{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-442-grid":{g:10,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-6x6-grid":{g:10,gr:[6,6],c:[{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:2},{r:2,c:2},{r:2,c:2}]},"11-4c4-t":{g:11,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-4x4-t":{g:11,gr:[4,4],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1}]},"11-4x6-t":{g:11,gr:[4,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"11-feat-t":{g:11,gr:[3,5],c:[{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-c":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-f":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5}]},"12-g4x3":{g:12,gr:[4,3]},"12-g3x4":{g:12,gr:[3,4]},"12-g6x6":{g:12,gr:[6,6],c:[{r:5,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-feat-c":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-211":{g:13,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-112":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"14-g7x2":{g:14,gr:[7,2]},"14-g4x4r":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"14-g4x4c":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g5x3":{g:15,gr:[5,3]},"15-g4x4c":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g4x4f":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"16-g4x4":{g:16,gr:[4,4]}},gt="2-t1b1",n={currentMode:"layout",shared:{spacing:10,radius:8,bgColor:"#FFFFFF",backgroundImage:null,borderWidths:{top:0,right:0,bottom:0,left:0},downloadQuality:"high-jpg",selectedTextId:null,selectedArrowId:null,selectedRectangleId:null,selectedEllipseId:null},layout:{activeCellId:null,currentLayoutId:gt,layoutDef:Z[gt],imagesData:{},texts:[],arrows:[],rectangles:[],ellipses:[],colFractions:[],rowFractions:[]},stitching:{direction:"horizontal",images:[],texts:[],arrows:[],rectangles:[],ellipses:[]}};function Tt(t){n.layout.currentLayoutId=t,n.layout.layoutDef=Z[t]}const X={start(t,e){t.preventDefault(),t.stopPropagation();const r=t.type.startsWith("touch"),c=r?t.touches[0]:t,s={startX:c.clientX,startY:c.clientY,initialState:e.getInitialState?e.getInitialState():{}};e.onStart&&e.onStart(s);const l=o=>{o.preventDefault();const i=o.type.startsWith("touch")?o.touches[0]:o;e.onMove&&e.onMove(i,s)},u=()=>{document.removeEventListener(r?"touchmove":"mousemove",l),document.removeEventListener(r?"touchend":"mouseup",u),e.onEnd&&e.onEnd()};document.addEventListener(r?"touchmove":"mousemove",l,{passive:!1}),document.addEventListener(r?"touchend":"mouseup",u)}};function ct(t,e){if(!e)return;const r=w("div","text-element-container");r.id=`text-container-${t.id}`,Object.assign(r.style,{top:`${t.top}%`,left:`${t.left}%`,transform:"translate(-50%, -50%)"});const c=w("div","text-content");c.innerText=t.content,c.contentEditable="true",Object.assign(c.style,{color:t.color,fontSize:`${t.fontSize}px`,whiteSpace:"nowrap"});const s=w("div","text-toolbar");s.innerHTML=`<input type="number" value="${t.fontSize}" data-property="fontSize" title="Font Size"><input type="color" value="${t.color}" data-property="color" title="Font Color">`;const l=w("button","delete-text-button");l.innerHTML="&times;",l.title="Delete Text",r.append(s,c,l),e.appendChild(r),r.addEventListener("click",d=>{d.stopPropagation(),F(t.id)});const u=d=>d.stopPropagation();s.addEventListener("mousedown",u),s.addEventListener("touchstart",u);const o=d=>{const g=d.target.dataset.property;g&&et({[g]:d.target.value})};s.addEventListener("input",o),s.addEventListener("change",o),c.addEventListener("blur",()=>et({content:c.innerText}));const i=d=>{d.stopPropagation(),d.preventDefault(),bt()};l.addEventListener("click",i),l.addEventListener("touchend",i);const a=d=>{d.target.closest(".text-toolbar")||d.target.closest(".delete-text-button")||(F(t.id),X.start(d,{getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeftPercent:parseFloat(r.style.left),startTopPercent:parseFloat(r.style.top)}),onMove:(g,f)=>{const{gridRect:v,startLeftPercent:h,startTopPercent:b}=f.initialState;if(v.width===0||v.height===0)return;const L=g.clientX-f.startX,k=g.clientY-f.startY;r.style.left=`${h+L/v.width*100}%`,r.style.top=`${b+k/v.height*100}%`},onEnd:()=>{et({left:parseFloat(r.style.left),top:parseFloat(r.style.top)})}}))};r.addEventListener("mousedown",a),r.addEventListener("touchstart",a)}function ot(t,e,r=null){if(!e)return;const c=w("div","arrow-container"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","line"),u=w("div","arrow-handle"),o=w("div","arrow-handle"),i=w("div","rotation-handle"),a=w("div","text-toolbar"),d=m=>{const y=r||e.getBoundingClientRect();if(y.width===0)return;const E=y.width*(m.x1/100),x=y.height*(m.y1/100),I=y.width*(m.x2/100),S=y.height*(m.y2/100),$=Math.min(E,I),P=Math.min(x,S);Object.assign(c.style,{left:`${$}px`,top:`${P}px`,width:`${Math.abs(E-I)}px`,height:`${Math.abs(x-S)}px`,transform:`rotate(${m.rotation||0}deg)`});const _=E-$,N=x-P;l.setAttribute("x1",_),l.setAttribute("y1",N),l.setAttribute("x2",I-$),l.setAttribute("y2",S-P),l.setAttribute("stroke-width",m.strokeWidth),l.setAttribute("stroke",m.color),l.setAttribute("stroke-linecap","butt");const at=s.querySelector("marker polygon");at&&at.setAttribute("fill",m.color),u.style.left=`${_}px`,u.style.top=`${N}px`,o.style.left=`${I-$}px`,o.style.top=`${S-P}px`};c.id=`arrow-container-${t.id}`,n.shared.selectedArrowId===t.id&&c.classList.add("selected");const g=`arrowhead-${t.id}`;s.innerHTML=`<defs>
        <marker
            id="${g}"
            viewBox="0 0 12 12"
            refX="10" refY="6"
            markerWidth="9" markerHeight="9"
            orient="auto">
            <polygon points="2 2, 11 6, 2 10, 2 8, 5 6, 2 4" fill="${t.color}"></polygon>
        </marker>
    </defs>`,l.setAttribute("marker-end",`url(#${g})`),s.appendChild(l),a.style.top="-45px",a.innerHTML=`<input type="number" value="${t.strokeWidth}" data-property="strokeWidth" title="Thickness" min="1" max="50"><input type="color" value="${t.color}" data-property="color" title="Color"><button class="toolbar-delete-btn" title="Delete Arrow">&times;</button>`,c.append(s,u,o,i,a),e.appendChild(c),d(t);const f=(m,y)=>{m.addEventListener("mousedown",E=>X.start(E,y)),m.addEventListener("touchstart",E=>X.start(E,y))},v=m=>m.stopPropagation();a.addEventListener("mousedown",v),a.addEventListener("touchstart",v);const h=m=>{const y={[m.target.dataset.property]:m.target.value};U(y);const E=n.layout.arrows.find(x=>x.id===t.id);E&&d(E)};a.addEventListener("input",h),a.addEventListener("change",h);const b=a.querySelector(".toolbar-delete-btn"),L=m=>{m.stopPropagation(),m.preventDefault(),wt()};b.addEventListener("click",L),b.addEventListener("touchend",L),f(c,{onStart:()=>R(t.id),getInitialState:()=>({initialData:{...t},containerStartLeft:c.offsetLeft,containerStartTop:c.offsetTop}),onMove:(m,y)=>{const E=m.clientX-y.startX,x=m.clientY-y.startY;c.style.left=`${y.initialState.containerStartLeft+E}px`,c.style.top=`${y.initialState.containerStartTop+x}px`},onEnd:()=>{const m=c.getBoundingClientRect(),y=n.layout.arrows.find(N=>N.id===t.id);if(!y)return;const E=e.getBoundingClientRect(),x=(y.x1<y.x2?y.x1:y.x2)/100*E.width,I=(y.y1<y.y2?y.y1:y.y2)/100*E.height,S=m.left-E.left-x,$=m.top-E.top-I,P=S/E.width*100,_=$/E.height*100;(Math.abs(P)>.01||Math.abs(_)>.01)&&U({x1:y.x1+P,y1:y.y1+_,x2:y.x2+P,y2:y.y2+_})}});const k=m=>({onStart:()=>R(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect()}),onMove:(y,E)=>{const{gridRect:x}=E.initialState;if(x.width===0||x.height===0)return;const I={...n.layout.arrows.find(S=>S.id===t.id)};I[m.x]=(y.clientX-x.left)/x.width*100,I[m.y]=(y.clientY-x.top)/x.height*100,U(I),d(I)},onEnd:()=>{var y;(y=C())==null||y.render()}});f(u,k({x:"x1",y:"y1"})),f(o,k({x:"x2",y:"y2"})),f(i,{onStart:()=>R(t.id),getInitialState:()=>{const m=c.getBoundingClientRect();return{centerX:m.left+m.width/2,centerY:m.top+m.height/2,initialRotation:t.rotation||0}},onMove:(m,y)=>{const{centerX:E,centerY:x,initialRotation:I}=y.initialState,S=Math.atan2(m.clientY-x,m.clientX-E)*(180/Math.PI),$=Math.atan2(y.startY-x,y.startX-E)*(180/Math.PI);c.style.transform=`rotate(${I+(S-$)}deg)`},onEnd:()=>{const m=c.style.transform,y=m?parseFloat(m.replace(/[^0-9.-]/g,"")):0;U({rotation:y})}})}function Y(t,e){if(!e)return;const r=w("div","shape-container");r.id=`shape-container-${t.id}`,Object.assign(r.style,{left:`${t.left}%`,top:`${t.top}%`,width:`${t.width}%`,height:`${t.height}%`,transform:"translate(-50%, -50%)"});const c=w("div","shape-element");c.style.border=`${t.strokeWidth}px solid ${t.color}`,t.type==="ellipse"&&(c.style.borderRadius="50%");const s=w("div","shape-toolbar");s.innerHTML=`<input type="number" value="${t.strokeWidth}" data-property="strokeWidth" title="线条粗细" min="1" max="50"><input type="color" value="${t.color}" data-property="color" title="线条颜色"><button class="toolbar-delete-btn" title="删除形状">&times;</button>`;const l=["n","ne","e","se","s","sw","w","nw"].map(h=>{const b=w("div",`resize-handle ${h}`);return b.dataset.direction=h,b});r.append(c,s,...l),e.appendChild(r),(n.shared.selectedRectangleId===t.id||n.shared.selectedEllipseId===t.id)&&r.classList.add("selected");const u=t.type==="rectangle"?H:j,o=t.type==="rectangle"?re:ce,i=t.type==="rectangle"?Et:Lt,a=(h,b)=>{h.addEventListener("mousedown",L=>X.start(L,b)),h.addEventListener("touchstart",L=>X.start(L,b))},d=h=>h.stopPropagation();s.addEventListener("mousedown",d),s.addEventListener("touchstart",d);const g=h=>{const b=h.target.type==="number"?parseFloat(h.target.value):h.target.value,L={[h.target.dataset.property]:b};o(L),c.style.borderColor=L.color||t.color,c.style.borderWidth=L.strokeWidth?`${L.strokeWidth}px`:`${t.strokeWidth}px`};s.addEventListener("input",g),s.addEventListener("change",g);const f=s.querySelector(".toolbar-delete-btn"),v=h=>{h.stopPropagation(),h.preventDefault(),i()};f.addEventListener("click",v),f.addEventListener("touchend",v),a(c,{onStart:()=>u(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeftPercent:t.left,startTopPercent:t.top}),onMove:(h,b)=>{const{gridRect:L,startLeftPercent:k,startTopPercent:m}=b.initialState;if(L.width===0||L.height===0)return;const y=h.clientX-b.startX,E=h.clientY-b.startY;r.style.left=`${k+y/L.width*100}%`,r.style.top=`${m+E/L.height*100}%`},onEnd:()=>o({left:parseFloat(r.style.left),top:parseFloat(r.style.top)})}),l.forEach(h=>{a(h,{onStart:()=>u(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeft:t.left,startTop:t.top,startWidth:t.width,startHeight:t.height,direction:h.dataset.direction}),onMove:(b,L)=>{const{gridRect:k,direction:m,...y}=L.initialState;if(k.width===0||k.height===0)return;const E=(b.clientX-L.startX)/k.width*100,x=(b.clientY-L.startY)/k.height*100;let I=y.startLeft,S=y.startTop,$=y.startWidth,P=y.startHeight;m.includes("e")&&($+=E),m.includes("w")&&($-=E,I+=E),m.includes("s")&&(P+=x),m.includes("n")&&(P-=x,S+=x),$>1&&P>1&&(r.style.left=`${I}%`,r.style.top=`${S}%`,r.style.width=`${$}%`,r.style.height=`${P}%`)},onEnd:()=>o({left:parseFloat(r.style.left),top:parseFloat(r.style.top),width:parseFloat(r.style.width),height:parseFloat(r.style.height)})})})}let K=!1,D=null,rt=-1;function Rt(){p.stitchingControls.classList.remove("hidden"),p.stitchingWrapper.classList.remove("hidden"),document.getElementById("stitching-placeholder").classList.toggle("hidden",n.stitching.images.length>0),At()}function Ft(){p.stitchingControls.classList.add("hidden"),p.stitchingWrapper.classList.add("hidden"),p.stitchingGrid.removeEventListener("mousedown",ht)}function Q(){const t=p.stitchingWrapper,e=p.stitchingGrid;if(n.stitching.images.length===0)t.classList.add("is-empty"),t.style.width="",t.style.height="";else{t.classList.remove("is-empty");const r=e.offsetWidth,c=e.offsetHeight;t.style.width=`${r}px`,t.style.height=`${c}px`}}function G(){const t=p.stitchingGrid,e=document.getElementById("stitching-placeholder"),r=p.stitchingWrapper;if(t.innerHTML="",n.stitching.images.length>0){e.classList.add("hidden"),r.className="collage-wrapper stitching-wrapper",t.className="collage-grid",t.classList.add(n.stitching.direction),t.style.position="relative",n.stitching.images.length>1&&t.classList.add("is-sortable");const l=[];n.stitching.images.forEach((u,o)=>{const i=w("div","stitched-image-container"),a=w("img"),d=new Promise((v,h)=>{a.onload=v,a.onerror=h});l.push(d),a.src=u,a.dataset.index=o;const g=w("button","delete-stitched-image-btn");g.innerHTML="&times;",g.title="删除图片",g.onclick=v=>{v.stopPropagation(),Nt(o)};const f=w("button","add-stitched-image-btn");f.innerHTML="+",f.title="在此后插入图片",f.onclick=v=>{v.stopPropagation();const h=w("input");h.type="file",h.multiple=!0,h.accept="image/*",h.style.display="none",h.onchange=b=>{b.target.files.length>0&&Ut(b.target.files,o),b.target.value=null,document.body.removeChild(h)},document.body.appendChild(h),h.click()},i.append(a,g,f),t.appendChild(i)}),Promise.all(l).then(()=>{console.log("All stitched images loaded, updating layout."),Q()}).catch(u=>{console.error("An image failed to load in stitching mode.",u),Q()})}else e.classList.remove("hidden"),t.classList.add("hidden");n.stitching.images.length===0&&Q();const c=p.stitchingGrid,s=n.stitching;s.texts.forEach(l=>ct(l,c)),s.arrows.forEach(l=>ot(l,c)),s.rectangles.forEach(l=>Y(l,c)),s.ellipses.forEach(l=>Y(l,c)),yt()}function At(){p.stitchingGrid.addEventListener("mousedown",ht)}function ht(t){if(t.target.tagName!=="IMG"||n.stitching.images.length<2||(t.preventDefault(),K=!0,D=t.target.closest(".stitched-image-container"),!D))return;const e=D.querySelector("img");rt=parseInt(e.dataset.index),D.classList.add("dragging"),document.addEventListener("mousemove",mt),document.addEventListener("mouseup",ft)}function mt(t){if(!K)return;p.stitchingGrid.querySelectorAll(".drag-over").forEach(r=>r.classList.remove("drag-over"));const e=t.target.closest(".stitched-image-container");e&&e!==D&&e.classList.add("drag-over")}function ft(t){if(!K)return;D.classList.remove("dragging"),p.stitchingGrid.querySelectorAll(".drag-over").forEach(r=>r.classList.remove("drag-over"));const e=t.target.closest(".stitched-image-container");if(e&&e!==D){const r=e.querySelector("img");if(r){const c=parseInt(r.dataset.index);Wt(rt,c)}}K=!1,D=null,rt=-1,document.removeEventListener("mousemove",mt),document.removeEventListener("mouseup",ft)}function Wt(t,e){const[r]=n.stitching.images.splice(t,1);n.stitching.images.splice(e,0,r),G()}function Dt(t){const e=Array.from(t).filter(c=>c.type.startsWith("image/"));if(e.length===0){B("未选择有效的图片文件","error");return}document.getElementById("stitching-placeholder").classList.add("hidden");const r=e.map(c=>new Promise(s=>{const l=new FileReader;l.onload=u=>s(u.target.result),l.readAsDataURL(c)}));Promise.all(r).then(c=>{n.stitching.images=n.stitching.images.concat(c),B(`成功添加 ${c.length} 张图片`,"success"),G(),A()})}function zt(){if(!(n.stitching.images.length<2)){for(let t=n.stitching.images.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n.stitching.images[t],n.stitching.images[e]]=[n.stitching.images[e],n.stitching.images[t]]}G(),B("图片已随机排序","info")}}function yt(){const{spacing:t,radius:e}=n.shared,r=p.stitchingGrid;r.style.gap=`${t}px`,r.querySelectorAll("img").forEach(c=>{c.style.borderRadius=`${e}px`}),requestAnimationFrame(()=>{n.stitching.images.length>0&&Q()})}function Ot(){const t=p.stitchingWrapper,e=p.stitchingGrid,r=document.createElement("div"),c=e.cloneNode(!0),s=window.getComputedStyle(t);Object.assign(r.style,{padding:s.padding,backgroundColor:s.backgroundColor,backgroundImage:s.backgroundImage,backgroundSize:s.backgroundSize,backgroundPosition:s.backgroundPosition,boxSizing:"border-box",position:"absolute",top:"-9999px",left:"-9999px"}),c.style.gap=window.getComputedStyle(e).gap,r.appendChild(c),document.body.appendChild(r);const l=()=>{document.body.removeChild(r)};return{element:r,options:{useCORS:!0,backgroundColor:null,scale:3,width:r.offsetWidth,height:r.offsetHeight},cleanup:l}}function vt(t){t!==n.stitching.direction&&(n.stitching.direction=t,document.querySelector("#stitching-direction-btns .active").classList.remove("active"),document.querySelector(`#stitching-direction-btns [data-direction="${t}"]`).classList.add("active"),G())}const Ht=Object.freeze(Object.defineProperty({__proto__:null,activate:Rt,applySharedStyles:yt,deactivate:Ft,getDownloadOptions:Ot,processFiles:Dt,render:G,setDirection:vt,shuffle:zt},Symbol.toStringTag,{value:"Module"}));function M(){return n.currentMode==="layout"?n.layout:n.stitching}function jt(){var t;(t=C())==null||t.shuffle()}function _t(t){n.shared.downloadQuality=t}function qt(){O(null),F(null),R(null),H(null),j(null);const t=C();if(!t)return;p.layoutGrid.querySelectorAll(".gutter").forEach(l=>l.style.display="none"),B("正在生成高清晰度图片...","info");const{element:e,options:r,cleanup:c}=t.getDownloadOptions(),s={...r,backgroundColor:null};html2canvas(e,s).then(l=>{c&&c(),p.layoutGrid.querySelectorAll(".gutter").forEach(g=>g.style.display="block");const u=document.createElement("a"),o=n.shared.downloadQuality;let i="jpeg",a=1,d="jpg";switch(o){case"high-jpg":i="jpeg",a=.95,d="jpg";break;case"medium-jpg":i="jpeg",a=.8,d="jpg";break;case"png":i="png",d="png";break}u.download=`${n.currentMode}-collage-${Date.now()}.${d}`,u.href=l.toDataURL(`image/${i}`,a),u.click(),B("图片已成功保存！","success")}).catch(l=>{c&&c(),p.layoutGrid.querySelectorAll(".gutter").forEach(u=>u.style.display="block"),console.error("截图失败:",l),B("截图失败，请重试","error")})}function Yt(t){n.currentMode==="layout"&&kt(t)}function Xt(t){var e;n.currentMode==="layout"&&((e=p.aspectRatioBtns.querySelector(".active"))==null||e.classList.remove("active"),t.classList.add("active"),st(),setTimeout(()=>{var r;return(r=C())==null?void 0:r.render()},100))}function Gt(t){n.currentMode==="stitching"&&vt(t)}function Nt(t){var e;n.currentMode==="stitching"&&(t>-1&&t<n.stitching.images.length&&n.stitching.images.splice(t,1),(e=C())==null||e.render(),A())}function Ut(t,e){if(n.currentMode!=="stitching")return;const r=Array.from(t).filter(s=>s.type.startsWith("image/"));if(r.length===0)return;const c=r.map(s=>new Promise(l=>{const u=new FileReader;u.onload=o=>l(o.target.result),u.readAsDataURL(s)}));Promise.all(c).then(s=>{var l;n.stitching.images.splice(e+1,0,...s),B(`成功插入 ${s.length} 张图片`,"success"),(l=C())==null||l.render(),A()})}function Vt(t){const e=C();e&&e.processFiles&&e.processFiles(t)}function Qt(t){const e=new FileReader;e.onload=r=>{n.shared.backgroundImage=r.target.result,T()},e.readAsDataURL(t)}function Zt(){n.shared.backgroundImage=null,T()}function Kt(){var s;const t=M(),r=window.innerWidth<768?16:24,c={id:Date.now(),content:"文字",color:"#ff0000",fontSize:r,top:30,left:30};t.texts.push(c),(s=C())==null||s.render(),F(c.id)}function F(t){var r;if(n.shared.selectedTextId===t)return;const e=n.shared.selectedTextId;if(n.shared.selectedTextId=t,e&&((r=document.getElementById(`text-container-${e}`))==null||r.classList.remove("selected")),t){const c=document.getElementById(`text-container-${t}`);if(c){c.classList.add("selected");const s=c.querySelector(".text-content");Jt(s)}}}function et(t){if(!n.shared.selectedTextId)return;const e=M().texts.find(s=>s.id===n.shared.selectedTextId);if(!e)return;Object.assign(e,t);const r=document.getElementById(`text-container-${e.id}`);if(!r)return;const c=r.querySelector(".text-content");c&&(t.content&&(c.innerText=t.content),t.fontSize&&(c.style.fontSize=`${t.fontSize}px`),t.color&&(c.style.color=t.color),t.top&&(c.style.top=`${t.top}%`),t.left&&(c.style.left=`${t.left}%`))}function bt(){var r;if(!n.shared.selectedTextId)return;const t=M(),e=t.texts.findIndex(c=>c.id===n.shared.selectedTextId);e>-1&&(t.texts.splice(e,1),(r=document.getElementById(`text-container-${n.shared.selectedTextId}`))==null||r.remove(),F(null))}function Jt(t){if(t&&(t.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u")){const e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const r=window.getSelection();r.removeAllRanges(),r.addRange(e)}}function te(){var s;const t=M(),e=window.innerWidth<768,r={strokeWidth:e?4:3,x1:e?20:25,y1:25,x2:e?45:35,y2:35},c={id:Date.now(),color:"#ff0000",rotation:0,...r};t.arrows.push(c),(s=C())==null||s.render(),R(c.id)}function R(t){var r,c;if(n.shared.selectedArrowId===t&&t!==null)return;const e=n.shared.selectedArrowId;n.shared.selectedArrowId=t,e&&((r=document.getElementById(`arrow-container-${e}`))==null||r.classList.remove("selected")),t&&((c=document.getElementById(`arrow-container-${t}`))==null||c.classList.add("selected"))}function U(t){if(!n.shared.selectedArrowId)return;const e=M().arrows.find(r=>r.id===n.shared.selectedArrowId);e&&Object.assign(e,t)}function wt(){var r;if(!n.shared.selectedArrowId)return;const t=M(),e=t.arrows.findIndex(c=>c.id===n.shared.selectedArrowId);e>-1&&(t.arrows.splice(e,1),(r=C())==null||r.render(),R(null))}function ee(){var c;const t=M(),e=window.innerWidth<768,r={id:Date.now(),type:"rectangle",color:"#ff0000",strokeWidth:4,left:30,top:30,width:e?20:15,height:e?15:10,rotation:0};t.rectangles.push(r),(c=C())==null||c.render(),H(r.id)}function H(t){var r,c;if(n.shared.selectedRectangleId===t)return;F(null),R(null),j(null);const e=n.shared.selectedRectangleId;n.shared.selectedRectangleId=t,e&&((r=document.getElementById(`shape-container-${e}`))==null||r.classList.remove("selected")),t&&((c=document.getElementById(`shape-container-${t}`))==null||c.classList.add("selected"))}function re(t){if(!n.shared.selectedRectangleId)return;const e=M().rectangles.find(r=>r.id===n.shared.selectedRectangleId);e&&Object.assign(e,t)}function Et(){var r;if(!n.shared.selectedRectangleId)return;const t=M(),e=t.rectangles.findIndex(c=>c.id===n.shared.selectedRectangleId);e>-1&&(t.rectangles.splice(e,1),(r=C())==null||r.render(),H(null))}function ne(){var c;const t=M(),e=window.innerWidth<768,r={id:Date.now(),type:"ellipse",color:"#ff0000",strokeWidth:4,left:30,top:30,width:e?20:15,height:e?20:15,rotation:0};t.ellipses.push(r),(c=C())==null||c.render(),j(r.id)}function j(t){var r,c;if(n.shared.selectedEllipseId===t)return;F(null),R(null),H(null);const e=n.shared.selectedEllipseId;n.shared.selectedEllipseId=t,e&&((r=document.getElementById(`shape-container-${e}`))==null||r.classList.remove("selected")),t&&((c=document.getElementById(`shape-container-${t}`))==null||c.classList.add("selected"))}function ce(t){if(!n.shared.selectedEllipseId)return;const e=M().ellipses.find(r=>r.id===n.shared.selectedEllipseId);e&&Object.assign(e,t)}function Lt(){var r;if(!n.shared.selectedEllipseId)return;const t=M(),e=t.ellipses.findIndex(c=>c.id===n.shared.selectedEllipseId);e>-1&&(t.ellipses.splice(e,1),(r=C())==null||r.render(),j(null))}function O(t){if(n.currentMode==="layout"&&n.layout.activeCellId!==t){if(n.layout.activeCellId){const e=document.getElementById(n.layout.activeCellId);e&&e.classList.remove("selected")}if(n.layout.activeCellId=t,t){const e=document.getElementById(t);e&&e.classList.add("selected")}}}function oe(t){if(typeof t!="string"||t.trim()==="")return[50,50];const e=t.split(" "),r=parseFloat(e[0]),c=e.length>1?parseFloat(e[1]):r;return[isNaN(r)?50:r,isNaN(c)?50:c]}function ie(t,e){if(n.currentMode!=="layout")return;const{activeCellId:r}=n.layout;if(!r)return;const c=n.layout.imagesData[r];if(!c||!c.src)return;const s=document.getElementById(r);if(!s)return;const[l,u]=oe(c.position);let o=l-t,i=u-e;o=Math.max(0,Math.min(100,o)),i=Math.max(0,Math.min(100,i));const a=`${o}% ${i}%`;c.position=a,s.style.backgroundPosition=a}function J(t){if(n.currentMode!=="layout")return;const{activeCellId:e}=n.layout;if(!e)return;const r=n.layout.imagesData[e];if(!r||!r.src)return;const c=Math.max(1,Math.min(t,5));r.scale=c,z(e,r)}function se(t){n.currentMode==="layout"&&(delete n.layout.imagesData[t],tt(t),O(null),A())}const xt=.2;function ae(){if(n.currentMode!=="layout")return;const{activeCellId:t}=n.layout;if(!t||!n.layout.imagesData[t])return;const r=(n.layout.imagesData[t].scale||1)+xt;J(r)}function le(){if(n.currentMode!=="layout")return;const{activeCellId:t}=n.layout;if(!t||!n.layout.imagesData[t])return;const r=(n.layout.imagesData[t].scale||1)-xt;J(r)}function de(t){if(n.currentMode!=="layout")return;const e=n.layout.imagesData[t];e&&(e.scale=1,e.position="50% 50%",z(t,e))}function ge(){var e;if(!confirm("您确定要清空整个画布吗？所有未保存的更改都将丢失。"))return;const t=M();t.texts=[],t.arrows=[],t.rectangles=[],t.ellipses=[],n.currentMode==="layout"?t.imagesData={}:n.currentMode==="stitching"&&(t.images=[]),O(null),F(null),R(null),H(null),j(null),(e=C())==null||e.render(),A(),B("画布已清空","info")}function it(){const t=p.layoutGrid;t.querySelectorAll(".gutter").forEach(u=>u.remove());const[e,r]=n.layout.layoutDef.gr,c=t.getBoundingClientRect(),s=n.layout.rowFractions.reduce((u,o)=>u+o,0),l=n.layout.colFractions.reduce((u,o)=>u+o,0);if(r>1){const u=n.layout.colFractions.map(i=>i/l*c.width);let o=0;for(let i=0;i<r-1;i++){o+=u[i];const a=w("div","gutter gutter-v");a.style.left=`${o}px`,a.style.height="100%",a.dataset.index=i,t.appendChild(a),ut(a,"v")}}if(e>1){const u=n.layout.rowFractions.map(i=>i/s*c.height);let o=0;for(let i=0;i<e-1;i++){o+=u[i];const a=w("div","gutter gutter-h");a.style.top=`${o}px`,a.style.width="100%",a.dataset.index=i,t.appendChild(a),ut(a,"h")}}}function ut(t,e){t.onmousedown=function(r){r.preventDefault();const c=p.layoutGrid,s=parseInt(t.dataset.index),l=c.getBoundingClientRect(),u=function(i){if(e==="v"){const a=n.layout.colFractions[s]+n.layout.colFractions[s+1],d=n.layout.colFractions.slice(0,s).reduce((h,b)=>h+b/n.layout.colFractions.reduce((L,k)=>L+k,0)*l.width,0);let f=(i.clientX-l.left-d)/l.width*n.layout.colFractions.reduce((h,b)=>h+b,0);f<.1&&(f=.1);let v=a-f;v<.1&&(v=.1,f=a-.1),n.layout.colFractions[s]=f,n.layout.colFractions[s+1]=v,c.style.gridTemplateColumns=n.layout.colFractions.map(h=>`${h}fr`).join(" ")}else{const a=n.layout.rowFractions[s]+n.layout.rowFractions[s+1],d=n.layout.rowFractions.slice(0,s).reduce((h,b)=>h+b/n.layout.rowFractions.reduce((L,k)=>L+k,0)*l.height,0);let f=(i.clientY-l.top-d)/l.height*n.layout.rowFractions.reduce((h,b)=>h+b,0);f<.1&&(f=.1);let v=a-f;v<.1&&(v=.1,f=a-.1),n.layout.rowFractions[s]=f,n.layout.rowFractions[s+1]=v,c.style.gridTemplateRows=n.layout.rowFractions.map(h=>`${h}fr`).join(" ")}},o=function(){document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",o),setTimeout(it,50)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",o)}}const ue=Object.freeze(Object.defineProperty({__proto__:null,createGutters:it},Symbol.toStringTag,{value:"Module"}));function pe(){p.layoutControls.classList.remove("hidden"),p.canvasSettings.classList.remove("hidden"),p.borderControls.classList.remove("hidden"),p.layoutWrapper.classList.remove("hidden"),p.canvasHint.classList.remove("hidden")}function he(){p.layoutControls.classList.add("hidden"),p.canvasSettings.classList.add("hidden"),p.layoutWrapper.classList.add("hidden"),p.canvasHint.classList.add("hidden")}function St(){const t=p.layoutGrid;t.innerHTML="";const e=n.layout.layoutDef;if(!e)return;const[r,c]=e.gr;n.layout.rowFractions=Array(r).fill(1),n.layout.colFractions=Array(c).fill(1),t.style.gridTemplateRows=n.layout.rowFractions.map(i=>`${i}fr`).join(" "),t.style.gridTemplateColumns=n.layout.colFractions.map(i=>`${i}fr`).join(" ");const s=e.c||Array.from({length:r*c},()=>({r:1,c:1})),l={...n.layout.imagesData},u={};s.forEach((i,a)=>{const d=`cell-${a}`,g=ye(d);if(g.style.gridRowEnd=`span ${i.r}`,g.style.gridColumnEnd=`span ${i.c}`,i.s&&(g.style.gridRowStart=i.s[0],g.style.gridColumnStart=i.s[1]),t.appendChild(g),l[d]){u[d]=l[d];const f=u[d];z(d,f)}}),n.layout.imagesData=u;const o=p.layoutGrid;n.layout.texts.forEach(i=>ct(i,o)),n.layout.arrows.forEach(i=>ot(i,o)),n.layout.rectangles.forEach(i=>Y(i,o)),n.layout.ellipses.forEach(i=>Y(i,o)),Ct(),setTimeout(it,100)}function It(t,e=null){var o;const r=Array.from(t).filter(i=>i.type.startsWith("image/"));if(r.length===0){B("未选择有效的图片文件","error");return}const c=(i,a)=>{const d=new FileReader;d.onload=g=>{const f=g.target.result,v=new Image;v.onload=()=>{const h={src:f,position:"50% 50%",scale:1,width:v.naturalWidth,height:v.naturalHeight};n.layout.imagesData[a]=h,z(a,h)},v.src=f},d.readAsDataURL(i)},s=[];e&&s.push(e),Array.from(document.querySelectorAll("#layout-grid .grid-cell")).map(i=>i.id).forEach(i=>{i!==e&&(!n.layout.imagesData[i]||!n.layout.imagesData[i].src)&&s.push(i)});const u=e&&((o=n.layout.imagesData[e])==null?void 0:o.src);if(s.length>0){const i=Math.min(r.length,s.length);B(`正在上传 ${i} 张图片...`,"info");let a=0;for(let d=0;d<i;d++)c(r[d],s[d]),a++;setTimeout(()=>{const d=`成功上传 ${a} 张图片。`+(r.length>a?` 已忽略 ${r.length-a} 张。`:"");B(d,"success"),A()},500)}else u?(B("画布已满，将替换当前图片。","info"),c(r[0],e)):B("没有空的格子可以放置图片","error")}function me(){const t=Object.entries(n.layout.imagesData);if(t.length<2)return;const e=t.map(r=>r[1]);for(let r=e.length-1;r>0;r--){const c=Math.floor(Math.random()*(r+1));[e[r],e[c]]=[e[c],e[r]]}t.forEach(([r],c)=>{n.layout.imagesData[r]=e[c],z(r,e[c])}),B("图片已随机排序","info")}function Ct(){const{spacing:t,radius:e}=n.shared,r=p.layoutGrid;r.style.gap=`${t}px`,r.querySelectorAll(".grid-cell").forEach(c=>{c.style.borderRadius=`${e}px`})}function fe(){const e=p.layoutWrapper,r=e.offsetWidth;if(!r)return{element:document.createElement("div"),options:{},cleanup:()=>{}};const c=Math.max(1,1600/r),s=r*c,l=window.getComputedStyle(e),u=parseFloat(l.width)/parseFloat(l.height),o=s/u,i=document.createElement("div");Object.assign(i.style,{position:"absolute",top:"-9999px",left:"-9999px",width:`${s}px`,height:`${o}px`});const a=e.cloneNode(!0),d=a.querySelector("#layout-grid");d.querySelectorAll(".text-element-container, .arrow-container, .shape-container").forEach(m=>m.remove()),a.style.boxSizing="border-box",a.style.width=`${s}px`,a.style.height=`${o}px`,a.style.backgroundColor=n.shared.bgColor,a.style.backgroundImage=n.shared.backgroundImage?`url(${n.shared.backgroundImage})`:"none",a.style.backgroundSize="cover",a.style.backgroundPosition="center";const g=n.shared.borderWidths||{top:0,right:0,bottom:0,left:0};if(a.style.paddingTop=`${g.top*c}px`,a.style.paddingRight=`${g.right*c}px`,a.style.paddingBottom=`${g.bottom*c}px`,a.style.paddingLeft=`${g.left*c}px`,d){d.style.boxSizing="border-box";const{spacing:m,radius:y}=n.shared,E=m*c,x=y*c;d.style.gap=`${E}px`,d.style.display="grid",d.style.gridTemplateRows=n.layout.rowFractions.map(S=>`${S}fr`).join(" "),d.style.gridTemplateColumns=n.layout.colFractions.map(S=>`${S}fr`).join(" "),d.querySelectorAll(".grid-cell").forEach(S=>{S.style.borderRadius=`${x}px`})}const f=parseFloat(a.style.paddingLeft)||0,v=parseFloat(a.style.paddingRight)||0,h=parseFloat(a.style.paddingTop)||0,b=parseFloat(a.style.paddingBottom)||0,L={width:s-f-v,height:o-h-b};return n.layout.texts.forEach(m=>ct({...m,fontSize:m.fontSize*c},d)),n.layout.arrows.forEach(m=>ot({...m,strokeWidth:m.strokeWidth*c},d,L)),n.layout.rectangles.forEach(m=>Y({...m,strokeWidth:m.strokeWidth*c},d)),n.layout.ellipses.forEach(m=>Y({...m,strokeWidth:m.strokeWidth*c},d)),i.appendChild(a),document.body.appendChild(i),{element:a,options:{useCORS:!0,backgroundColor:null,scale:2},cleanup:()=>{document.body.removeChild(i)}}}function kt(t){var e,r;t!==n.layout.currentLayoutId&&((e=p.layoutContainer.querySelector(".active"))==null||e.classList.remove("active"),(r=p.layoutContainer.querySelector(`[data-layout="${t}"]`))==null||r.classList.add("active"),Tt(t),St())}function Bt(t,e){if(!e)return;const r=n.layout.imagesData[t]?{...n.layout.imagesData[t]}:null,c=n.layout.imagesData[e]?{...n.layout.imagesData[e]}:null;r&&(r.position="50% 50%",r.scale=1),c&&(c.position="50% 50%",c.scale=1),n.layout.imagesData[t]=c,c?z(t,c):(delete n.layout.imagesData[t],tt(t)),n.layout.imagesData[e]=r,r?z(e,r):(delete n.layout.imagesData[e],tt(e))}function ye(t){const e=w("div","grid-cell");e.id=t;const r=w("input");r.type="file",r.accept="image/*",r.id=`input-${t}`,r.multiple=!0,r.className="hidden-file-input",r.onchange=g=>{g.target.files.length>0&&It(g.target.files,t),g.target.value=null};const c=w("div","upload-icon-container");c.innerHTML=q.upload;const s=w("div","cell-button-container"),l=w("div","cell-icon-btn zoom-in-btn");l.innerHTML=q.zoomIn,l.title="放大";const u=w("div","cell-icon-btn zoom-out-btn");u.innerHTML=q.zoomOut,u.title="缩小";const o=w("div","cell-icon-btn reset-btn");o.innerHTML=q.zoomReset,o.title="还原";const i=w("div","cell-icon-btn replace-btn");i.innerHTML=q.replace,i.title="替换图片";const a=w("div","cell-icon-btn remove-btn");a.innerHTML=q.remove,a.title="删除图片",l.onclick=g=>{g.stopPropagation(),O(t),ae()},u.onclick=g=>{g.stopPropagation(),O(t),le()},o.onclick=g=>{g.stopPropagation(),de(t)},i.onclick=g=>{g.stopPropagation(),r.click()},a.onclick=g=>{g.stopPropagation(),se(t)},s.append(l,u,o,i,a),e.append(c,r,s),e.addEventListener("wheel",g=>{var L;if(e.id!==n.layout.activeCellId||!e.classList.contains("has-image"))return;g.preventDefault(),g.stopPropagation();const f=((L=n.layout.imagesData[e.id])==null?void 0:L.scale)||1,v=.1,h=g.deltaY<0?1:-1,b=f+h*v;J(b)},{passive:!1});const d={isPinching:!1,initialDistance:0,initialScale:1};return e.addEventListener("touchstart",g=>{var f;g.touches.length===2&&e.id===n.layout.activeCellId&&(g.preventDefault(),d.isPinching=!0,d.initialDistance=Math.hypot(g.touches[0].pageX-g.touches[1].pageX,g.touches[0].pageY-g.touches[1].pageY),d.initialScale=((f=n.layout.imagesData[e.id])==null?void 0:f.scale)||1)},{passive:!1}),e.addEventListener("touchmove",g=>{if(d.isPinching&&g.touches.length===2){g.preventDefault();const v=Math.hypot(g.touches[0].pageX-g.touches[1].pageX,g.touches[0].pageY-g.touches[1].pageY)/d.initialDistance,h=d.initialScale*v,b=Math.max(1,Math.min(h,5));e.style.backgroundSize=`${b*100}%`}},{passive:!1}),e.addEventListener("touchend",g=>{if(d.isPinching){const f=parseFloat(e.style.backgroundSize)/100;J(f),d.isPinching=!1,d.initialDistance=0,d.initialScale=1}}),e}const ve=Object.freeze(Object.defineProperty({__proto__:null,activate:pe,applySharedStyles:Ct,deactivate:he,getDownloadOptions:fe,processFiles:It,render:St,selectNewLayout:kt,shuffle:me,swapImages:Bt},Symbol.toStringTag,{value:"Module"})),be={layout:ve,stitching:Ht};let W=null;function C(){return W}function nt(t){n.currentMode===t&&W||(W&&W.deactivate(),n.currentMode=t,W=be[t],W.activate(),p.layoutModeBtn.classList.toggle("active",t==="layout"),p.stitchingModeBtn.classList.toggle("active",t==="stitching"),we(),A())}function we(){W&&W.render()}let pt;function B(t,e="info",r=3e3){const c=document.getElementById("toast");c&&(clearTimeout(pt),c.textContent=t,c.className="toast",c.classList.add(e),c.classList.add("show"),pt=setTimeout(()=>{c.classList.remove("show")},r))}const V=t=>{const e=parseInt(t.value,10);return isNaN(e)||e<0?0:e};function T(){var d;const t=p.spacingSlider.value,e=p.radiusSlider.value,r=p.colorPicker.value,c=V(p.borderTopInput),s=V(p.borderRightInput),l=V(p.borderBottomInput),u=V(p.borderLeftInput);n.shared.spacing=t,n.shared.radius=e,n.shared.bgColor=r,n.shared.borderWidths={top:c,right:s,bottom:l,left:u},p.spacingValue.textContent=t,p.radiusValue.textContent=e;const o=p.layoutWrapper;n.shared.backgroundImage?(o.style.backgroundImage=`url(${n.shared.backgroundImage})`,o.style.backgroundSize="cover",o.style.backgroundPosition="center"):(o.style.backgroundImage="none",o.style.backgroundColor=n.shared.bgColor),o.style.paddingTop=`${n.shared.borderWidths.top}px`,o.style.paddingRight=`${n.shared.borderWidths.right}px`,o.style.paddingBottom=`${n.shared.borderWidths.bottom}px`,o.style.paddingLeft=`${n.shared.borderWidths.left}px`;const i=p.stitchingWrapper,a=p.stitchingGrid;n.shared.backgroundImage?(i.style.backgroundImage=`url(${n.shared.backgroundImage})`,i.style.backgroundSize="cover",i.style.backgroundPosition="center"):(i.style.backgroundImage="none",i.style.backgroundColor=n.shared.bgColor),i.style.padding="0",a.style.paddingTop=`${n.shared.borderWidths.top}px`,a.style.paddingRight=`${n.shared.borderWidths.right}px`,a.style.paddingBottom=`${n.shared.borderWidths.bottom}px`,a.style.paddingLeft=`${n.shared.borderWidths.left}px`,(d=C())==null||d.applySharedStyles(),n.currentMode==="stitching"&&requestAnimationFrame(()=>{const g=C();g&&typeof g.updateLayout=="function"&&g.updateLayout()})}function z(t,e){const r=document.getElementById(t);if(!r||!e||!e.src)return;r.style.backgroundImage=`url('${e.src}')`,r.style.backgroundPosition=e.position,r.classList.add("has-image");const c=r.querySelector(".upload-icon-container");c&&(c.style.display="none");const s=r.clientWidth,l=r.clientHeight;if(!e.width||!e.height||!s||!l){r.style.backgroundSize="cover";return}const u=s/l,o=e.width/e.height,i=e.scale||1;let a;o>u?a=`auto ${i*100}%`:a=`${i*100}% auto`,r.style.backgroundSize=a}function tt(t){const e=document.getElementById(t);if(!e)return;e.style.backgroundImage="none",e.classList.remove("has-image");const r=e.querySelector(".upload-icon-container");r&&(r.style.display="flex")}function A(){let t=0;n.currentMode==="layout"?t=Object.keys(n.layout.imagesData).length:t=n.stitching.images.length,p.shuffleBtn.disabled=t<2}function st(){const t=document.getElementById("center-content"),e=document.getElementById("layout-wrapper"),r=document.getElementById("aspect-ratio-btns"),c=document.getElementById("canvas-action-toolbar");if(!t||!e||!r||!c){console.error("无法找到布局容器或工具栏元素，计算中止。");return}const s=window.getComputedStyle(t),l=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight),u=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom),o=t.clientWidth-l;let i=t.clientHeight-u;const a=window.getComputedStyle(c),d=c.offsetHeight+parseFloat(a.marginBottom);i-=d;const g=r.querySelector(".active");if(!g)return;const f=g.dataset.ratio.split("/"),v=parseFloat(f[0])/parseFloat(f[1]);let h,b;o/i>v?(b=i,h=b*v):(h=o,b=h/v),e.style.width=`${h}px`,e.style.height=`${b}px`,c.style.width=`${h}px`}const Ee=Object.freeze(Object.defineProperty({__proto__:null,applyCanvasStyles:T,applyImageToCell:z,clearImageFromCell:tt,showToast:B,updateCanvasSize:st,updateShuffleButton:A},Symbol.toStringTag,{value:"Module"}));(function(){const t="img.ops-coffee.cn",e=window.location.hostname;e&&e!==t&&e!=="localhost"&&(window.location.href=`https://${t}`)})();function Le(){p.layoutContainer.innerHTML="";const t={};for(const e in Z){const r=Z[e];t[r.g]||(t[r.g]=[]),t[r.g].push({id:e,...r})}Object.keys(t).sort((e,r)=>e-r).forEach(e=>{const r=w("h4","layout-group-title");r.textContent=`${e} 张图片`,p.layoutContainer.appendChild(r);const c=w("div","layout-thumbnail-grid");t[e].forEach(s=>{const l=xe(s.id,s);s.id===n.layout.currentLayoutId&&l.classList.add("active"),c.appendChild(l)}),p.layoutContainer.appendChild(c)})}function xe(t,e){const r=w("div","layout-thumbnail");r.dataset.layout=t;const c=w("div","thumbnail-grid");return c.style.gridTemplateColumns=`repeat(${e.gr[1]}, 1fr)`,c.style.gridTemplateRows=`repeat(${e.gr[0]}, 1fr)`,(e.c||Array.from({length:e.gr[0]*e.gr[1]},()=>({r:1,c:1}))).forEach(l=>{const u=w("div","thumbnail-cell");u.style.gridRowEnd=`span ${l.r}`,u.style.gridColumnEnd=`span ${l.c}`,l.s&&(u.style.gridRowStart=l.s[0],u.style.gridColumnStart=l.s[1]),c.appendChild(u)}),r.appendChild(c),r}function Se(){p.layoutModeBtn.addEventListener("click",()=>nt("layout")),p.stitchingModeBtn.addEventListener("click",()=>nt("stitching")),p.stitchingUploadBtn.addEventListener("click",()=>p.stitchingUploadInput.click()),p.stitchingUploadInput.addEventListener("change",o=>{Vt(o.target.files),o.target.value=null}),p.stitchingDirectionBtns.addEventListener("click",o=>{const i=o.target.closest("button");i&&Gt(i.dataset.direction)}),p.layoutContainer.addEventListener("click",o=>{const i=o.target.closest(".layout-thumbnail");i&&(Yt(i.dataset.layout),document.getElementById("left-sidebar").classList.contains("is-open")&&document.getElementById("mobile-overlay").click())}),p.aspectRatioBtns.addEventListener("click",o=>{const i=o.target.closest("button");i&&Xt(i)}),p.spacingSlider.addEventListener("input",T),p.radiusSlider.addEventListener("input",T),p.borderTopInput.addEventListener("input",T),p.borderRightInput.addEventListener("input",T),p.borderBottomInput.addEventListener("input",T),p.borderLeftInput.addEventListener("input",T),p.colorPicker.addEventListener("input",T),p.downloadBtn.addEventListener("click",qt);const t=document.getElementById("bg-upload-input");document.getElementById("upload-bg-btn").addEventListener("click",()=>t.click()),t.addEventListener("change",o=>{o.target.files&&o.target.files[0]&&Qt(o.target.files[0]),o.target.value=null}),document.getElementById("remove-bg-btn").addEventListener("click",Zt),document.getElementById("add-text-btn").addEventListener("click",Kt),document.getElementById("add-arrow-btn").addEventListener("click",te),document.getElementById("add-rectangle-btn").addEventListener("click",ee),document.getElementById("add-ellipse-btn").addEventListener("click",ne),document.getElementById("shuffle-btn").addEventListener("click",jt),document.getElementById("clear-canvas-btn").addEventListener("click",ge);let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{n.currentMode==="layout"&&(dt(async()=>{const{updateCanvasSize:o}=await Promise.resolve().then(()=>Ee);return{updateCanvasSize:o}},void 0).then(({updateCanvasSize:o})=>o()),dt(async()=>{const{createGutters:o}=await Promise.resolve().then(()=>ue);return{createGutters:o}},void 0).then(({createGutters:o})=>o()))},150)});const r=document.getElementById("left-sidebar"),c=document.getElementById("right-sidebar"),s=document.getElementById("mobile-overlay"),l=()=>{r.classList.remove("is-open"),c.classList.remove("is-open"),s.classList.add("hidden"),document.body.classList.remove("sidebar-open")};document.getElementById("toggle-left-sidebar").addEventListener("click",o=>{o.stopPropagation(),r.classList.toggle("is-open")?(c.classList.remove("is-open"),s.classList.remove("hidden"),document.body.classList.add("sidebar-open")):l()}),document.getElementById("toggle-right-sidebar").addEventListener("click",o=>{o.stopPropagation(),c.classList.toggle("is-open")?(r.classList.remove("is-open"),s.classList.remove("hidden"),document.body.classList.add("sidebar-open")):l()}),s.addEventListener("click",l);const u=document.getElementById("app-container");document.getElementById("pc-toggle-left").addEventListener("click",()=>u.classList.toggle("left-sidebar-collapsed")),document.getElementById("pc-toggle-right").addEventListener("click",()=>u.classList.toggle("right-sidebar-collapsed")),document.getElementById("stitching-placeholder").addEventListener("click",()=>p.stitchingUploadInput.click()),Ie(),document.addEventListener("click",o=>{const i=o.target,a=i.closest(".grid-cell, .text-element-container, .arrow-container, .shape-container"),d=i.closest("#right-sidebar"),g=i.closest("#canvas-action-toolbar");a||d||g||(O(null),F(null),R(null),H(null),j(null))}),document.addEventListener("keydown",o=>{const i=o.target;if(!(i.isContentEditable||i.tagName==="INPUT"||i.tagName==="TEXTAREA")){if(o.key==="Delete"||o.key==="Backspace"){o.preventDefault(),n.shared.selectedTextId?bt():n.shared.selectedArrowId?wt():n.shared.selectedRectangleId?Et():n.shared.selectedEllipseId&&Lt();return}if(n.currentMode==="layout"&&n.layout.activeCellId){let d=0,g=0;switch(o.key){case"ArrowUp":g=-1.5;break;case"ArrowDown":g=1.5;break;case"ArrowLeft":d=-1.5;break;case"ArrowRight":d=1.5;break;default:return}o.preventDefault(),ie(d,g)}}})}function Ie(){const t=document.getElementById("layout-grid");let e={};function r(){e.startCell&&e.startCell.classList.remove("dragging"),e.activeCell&&e.activeCell.classList.remove("is-panning"),e={isMouseDown:!1,isPanning:!1,isDragging:!1,hasMoved:!1,startCell:null,activeCell:null,startX:0,startY:0,startBgPercentX:0,startBgPercentY:0},document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}function c(o,i){if(typeof o!="string")return 50;const a=o.trim();if(a.endsWith("%"))return parseFloat(a);if(a.endsWith("px"))return parseFloat(a)/i*100;switch(a){case"top":case"left":return 0;case"bottom":case"right":return 100;case"center":return 50}return 50}t.addEventListener("mousedown",o=>{if(o.button!==0)return;const i=o.target.closest(".grid-cell");!i||o.target.closest(".remove-image-btn")||(r(),e.isMouseDown=!0,e.startCell=i,e.startX=o.clientX,e.startY=o.clientY,document.addEventListener("mousemove",l),document.addEventListener("mouseup",u))});let s=null;function l(o){var i,a;if(e.isMouseDown){if(e.isPanning){const d=e.activeCell.getBoundingClientRect(),g=(o.clientX-e.startX)/d.width*100,f=(o.clientY-e.startY)/d.height*100;let v=e.startBgPercentX-g,h=e.startBgPercentY-f;v=Math.max(0,Math.min(100,v)),h=Math.max(0,Math.min(100,h)),e.activeCell.style.backgroundPosition=`${v}% ${h}%`;return}if(e.isDragging){const d=(i=document.elementFromPoint(o.clientX,o.clientY))==null?void 0:i.closest(".grid-cell");d!==s&&(s&&s.classList.remove("drag-over"),d&&d!==e.startCell&&d.classList.add("drag-over"),s=d);return}if(!e.hasMoved&&(Math.abs(o.clientX-e.startX)>5||Math.abs(o.clientY-e.startY)>5))if(e.hasMoved=!0,o.altKey&&e.startCell.classList.contains("has-image")){e.isPanning=!0,e.activeCell=e.startCell,e.activeCell.classList.add("is-panning");const d=e.activeCell.id,f=(((a=n.layout.imagesData[d])==null?void 0:a.position)||"50% 50%").split(" "),v=e.activeCell.getBoundingClientRect();e.startBgPercentX=c(f[0],v.width),e.startBgPercentY=c(f.length>1?f[1]:f[0],v.height)}else e.startCell.classList.contains("has-image")&&(e.isDragging=!0,e.startCell.classList.add("dragging"))}}function u(o){var i;if(e.isMouseDown){if(e.isPanning){const a=e.activeCell.id;n.layout.imagesData[a]&&(n.layout.imagesData[a].position=e.activeCell.style.backgroundPosition)}else if(e.isDragging){const a=(i=document.elementFromPoint(o.clientX,o.clientY))==null?void 0:i.closest(".grid-cell");a&&a!==e.startCell&&Bt(e.startCell.id,a.id)}else if(!e.hasMoved)if(e.startCell.classList.contains("has-image"))O(e.startCell.id);else{const a=e.startCell.querySelector('input[type="file"]');a&&a.click()}s&&(s.classList.remove("drag-over"),s=null),r()}}}function Ce(){var c;const t=document.getElementById("quality-selector");if(!t)return;const e=n.shared.downloadQuality,r=t.querySelector(`[data-quality="${e}"]`);r&&((c=t.querySelector(".active"))==null||c.classList.remove("active"),r.classList.add("active")),t.addEventListener("click",s=>{var u;const l=s.target.closest("button");!l||!l.dataset.quality||((u=t.querySelector(".active"))==null||u.classList.remove("active"),l.classList.add("active"),_t(l.dataset.quality))})}function ke(){if(navigator.userAgent.toLowerCase().includes("micromessenger")){const r=document.getElementById("wechat-overlay");r&&r.classList.remove("hidden")}}function Be(){ke(),Mt(),Le(),Se(),nt("layout");const t=p.aspectRatioBtns.querySelector('[data-ratio="1/1"]');t&&t.classList.add("active"),T(),st(),A(),Ce(),console.log("%c 免费在线拼图工具 %c by ops-coffee.cn ","background: #0052cc; color: #fff; padding: 5px; border-radius: 5px 0 0 5px;","background: #f4f5f7; color: #42526e; padding: 5px; border-radius: 0 5px 5px 0;"),console.log("感谢使用！如果您对这个工具有任何建议，欢迎联系我们。微信公众号搜索：运维咖啡吧")}document.addEventListener("DOMContentLoaded",Be);
